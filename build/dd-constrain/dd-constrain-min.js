YUI.add("dd-constrain",function(d,f){var m="dragNode",b="offsetHeight",h="offsetWidth",r="host",o="tickXArray",l="tickYArray",e=d.DD.DDM,p="top",i="right",g="bottom",j="left",q="view",n=null,c="drag:tickAlignX",a="drag:tickAlignY",k=function(s){this._lazyAddAttrs=false;k.superclass.constructor.apply(this,arguments);};k.NAME="ddConstrained";k.NS="con";k.ATTRS={host:{},stickX:{value:false},stickY:{value:false},tickX:{value:false},tickY:{value:false},tickXArray:{value:false},tickYArray:{value:false},gutter:{value:"0",setter:function(s){return d.DD.DDM.cssSizestoObject(s);}},constrain:{value:q,setter:function(s){var t=d.one(s);if(t){s=t;}return s;}},constrain2region:{setter:function(s){return this.set("constrain",s);}},constrain2node:{setter:function(s){return this.set("constrain",d.one(s));}},constrain2view:{setter:function(s){return this.set("constrain",q);}},cacheRegion:{value:true}};n={_lastTickXFired:null,_lastTickYFired:null,initializer:function(){this._createEvents();this._eventHandles=[this.get(r).on("drag:end",d.bind(this._handleEnd,this)),this.get(r).on("drag:start",d.bind(this._handleStart,this)),this.get(r).after("drag:align",d.bind(this.align,this)),this.get(r).after("drag:drag",d.bind(this.drag,this))];},destructor:function(){d.each(this._eventHandles,function(t,s){t.detach();});this._eventHandles.length=0;},_createEvents:function(){var s=[c,a];d.each(s,function(u,t){this.publish(u,{type:u,emitFacade:true,bubbles:true,queuable:false,prefix:"drag"});},this);},_handleEnd:function(){this._lastTickYFired=null;this._lastTickXFired=null;},_handleStart:function(){this.resetCache();},_regionCache:null,_cacheRegion:function(){this._regionCache=this.get("constrain").get("region");},resetCache:function(){this._regionCache=null;},_getConstraint:function(){var s=this.get("constrain"),t=this.get("gutter"),u;if(s){if(s instanceof d.Node){if(!this._regionCache){this._eventHandles.push(d.on("resize",d.bind(this._cacheRegion,this),d.config.win));this._cacheRegion();}u=d.clone(this._regionCache);if(!this.get("cacheRegion")){this.resetCache();}}else{if(d.Lang.isObject(s)){u=d.clone(s);}}}if(!s||!u){s=q;}if(s===q){u=this.get(r).get(m).get("viewportRegion");}d.each(t,function(v,w){if((w==i)||(w==g)){u[w]-=v;}else{u[w]+=v;}});return u;},getRegion:function(w){var u={},v=null,s=null,t=this.get(r);u=this._getConstraint();if(w){v=t.get(m).get(b);s=t.get(m).get(h);u[i]=u[i]-s;u[g]=u[g]-v;}return u;},_checkRegion:function(s){var u=s,w=this.getRegion(),v=this.get(r),x=v.get(m).get(b),t=v.get(m).get(h);if(u[1]>(w[g]-x)){s[1]=(w[g]-x);}if(w[p]>u[1]){s[1]=w[p];}if(u[0]>(w[i]-t)){s[0]=(w[i]-t);}if(w[j]>u[0]){s[0]=w[j];}return s;},inRegion:function(u){u=u||this.get(r).get(m).getXY();var t=this._checkRegion([u[0],u[1]]),s=false;if((u[0]===t[0])&&(u[1]===t[1])){s=true;}return s;},align:function(){var u=this.get(r),s=[u.actXY[0],u.actXY[1]],t=this.getRegion(true);if(this.get("stickX")){s[1]=(u.startXY[1]-u.deltaXY[1]);}if(this.get("stickY")){s[0]=(u.startXY[0]-u.deltaXY[0]);}if(t){s=this._checkRegion(s);}s=this._checkTicks(s,t);u.actXY=s;},drag:function(w){var v=this.get(r),t=this.get("tickX"),u=this.get("tickY"),s=[v.actXY[0],v.actXY[1]];if((d.Lang.isNumber(t)||this.get(o))&&(this._lastTickXFired!==s[0])){this._tickAlignX();this._lastTickXFired=s[0];}if((d.Lang.isNumber(u)||this.get(l))&&(this._lastTickYFired!==s[1])){this._tickAlignY();this._lastTickYFired=s[1];}},_checkTicks:function(y,w){var v=this.get(r),x=(v.startXY[0]-v.deltaXY[0]),u=(v.startXY[1]-v.deltaXY[1]),s=this.get("tickX"),t=this.get("tickY");if(s&&!this.get(o)){y[0]=e._calcTicks(y[0],x,s,w[j],w[i]);}if(t&&!this.get(l)){y[1]=e._calcTicks(y[1],u,t,w[p],w[g]);}if(this.get(o)){y[0]=e._calcTickArray(y[0],this.get(o),w[j],w[i]);}if(this.get(l)){y[1]=e._calcTickArray(y[1],this.get(l),w[p],w[g]);}return y;},_tickAlignX:function(){this.fire(c);},_tickAlignY:function(){this.fire(a);}};d.namespace("Plugin");d.extend(k,d.Base,n);d.Plugin.DDConstrained=k;d.mix(e,{_calcTicks:function(z,y,v,x,w){var t=((z-y)/v),u=Math.floor(t),s=Math.ceil(t);if((u!==0)||(s!==0)){if((t>=u)&&(t<=s)){z=(y+(v*u));if(x&&w){if(z<x){z=(y+(v*(u+1)));}if(z>w){z=(y+(v*(u-1)));}}}}return z;},_calcTickArray:function(A,B,z,w){var t=0,x=B.length,v=0,u,s,y;if(!B||(B.length===0)){return A;}if(B[0]>=A){return B[0];}for(t=0;t<x;t++){v=(t+1);if(B[v]&&B[v]>=A){u=A-B[t];s=B[v]-A;y=(s>u)?B[t]:B[v];if(z&&w){if(y>w){if(B[t]){y=B[t];}else{y=B[x-1];}}}return y;}}return B[B.length-1];}});},"@VERSION@",{"requires":["dd-drag"]});