YUI.add("datatable-editable",function(e,t){var n=e.Lang,r=e.Array.each,i=e.Object.each,s="editable",o="editorOpenAction",u="defaultEditor",a="wrapAroundNavigation",f="Change",l="celleditor",c="col",h="columns",p=27,d=13,v=9,m=38,g=40,y=39,b=37,w=function(){};w.ATTRS={editable:{value:!1,validator:n.isBoolean},editorOpenAction:{value:"dblclick",validator:function(e){return typeof e=="string"||e===null}},editorOpenKey:{value:[13,113],setter:function(t){return t?e.Array(t):t}},defaultEditor:{value:"inline",validator:function(e){return typeof e=="string"||e===null}},wrapAroundNavigation:{value:!0,validator:n.isBoolean},rowEditor:{value:!1,validator:n.isBoolean},rowEditorOptions:{valueFn:function(){return{buttons:[{save:!0},{cancel:!0}]}}}},e.mix(w.prototype,{_openEditor:null,_editorRow:!1,_rowEditor:null,_editorRecord:null,_editorColName:null,_editorNode:null,_subscrEditable:null,_subscrEditOpen:null,_classColEditable:null,_classCellEditing:null,_commonEditors:null,_columnEditors:null,_editorsContainer:null,initializer:function(){this._classColEditable=this.getClassName(c,s),this._classCellEditing=this.getClassName(l,"editing");var e=this._UI_ATTRS;this._UI_ATTRS={SYNC:e.SYNC.concat(o),BIND:e.BIND.concat(s,o,h,"rowEditorOptions")},this.onceAfter("render",this._afterEditableRender)},destructor:function(){this.set(s,!1),this._editorsContainer.remove(!0)},_afterEditableRender:function(){this._editorsContainer=e.one("body").appendChild('<div class="'+this.getClassName("cell","editors")+'"></div>'),this.get(s)&&(this._bindEditable(),this._buildColumnEditors())},openCellEditor:function(e){var t=this.getColumn(e),n=t.name||t.key,r=this.getRecord(e),i=n?this._columnEditors[n]:null,s=i&&(typeof i=="string"?this._commonEditors[i]:i);if(!e||t&&t.editable===!1&&!s)return;if(!this.hideEditor())return;this.set("focusedCell",e),this.blur(),s&&(this.scrollTo&&this.isHidden(e,!0)&&this.scrollTo(e),e.addClass(this._classCellEditing),this._editorRow=!1,this._openEditor=s,this._editorNode=e,this._editorRecord=r,this._editorColName=n,s.showEditor({td:e,record:r,colName:n,recordKey:t.key,initialValue:r.get(t.key)}))},openRowEditor:function(t){var n=t.ancestor("tr",!0),i,s=this.getRecord(n),o=this._rowEditor,u,a=this._commonEditors;if(!this.hideEditor())return;a&&(r(this._displayColumns,function(e){var t=e.name||e.key,n=this._columnEditors[t],r,i=!!n;typeof n=="string"&&(r=n,a[r]?(n=a[r],delete a[r]):(n=this._createCellEditorInstance(r,{}),i=!1),this._columnEditors[t]=n),i&&this._editorsContainer.append(n.get("container"))},this),this._commonEditors=null),t.get("tagName").toLowerCase()==="tr"?i=t.get("firstChild"):i=t.ancestor("td",!0),this.set("focusedCell",i),this.blur(),n.scrollIntoView(),n.addClass(this._classCellEditing),o||(u=this.get("rowEditorOptions"),u.dt=this,this._rowEditor=o=(new e.DataTable.RowEditor(u)).render(),o.addTarget(this)),this._openEditor=o,this._editorRow=!0,this._editorNode=n,this._editorRecord=s,o.showEditor({focusOn:this.getColumn(i),tr:n,record:s})},hideEditor:function(e){var t=this._openEditor;if(t&&t.get("active"))if(e)t._hideEditor(),this._hideEditorCntd();else if(!t.cancelEditor())return!1;return!0},_hideEditorCntd:function(){var e=this._editorNode;e&&(e.removeClass(this._classCellEditing),this.focus()),this._openEditor=null,this._editorRecord=null,this._editorColName=null,this._editorNode=null},getCellEditor:function(e){e=this.getColumn(e);if(!e)return null;var t=this._columnEditors[e.name||e.key];return typeof t=="string"&&(t=this._commonEditors[t]),t||null},_bindEditable:function(){this._subscrEditable&&r(this._subscrEditable,function(e){e&&e.detach&&e.detach()}),this._subscrEditable=[this.after("sort",this._afterEditableSort),this.after(u+f,this._afterDefaultEditorChange),this.after(l+":save",this._afterCellEditorSave),this.after(l+":cancel",this._afterCellEditorCancel),this.after("roweditor:save",this._afterRowEditorSave),this.after("roweditor:cancel",this._afterRowEditorCancel),this._editorsContainer.on("keydown",this._onKeyDown,this),this.after("scroll",this._onScrollUpdateCellEditor),e.on("windowresize",e.bind(this._onScrollUpdateCellEditor,this)),this._editorsContainer.on("clickoutside",this._afterClickOutside,this),this.after("editorOpenKeyChange",this._afterEditorOpenKeyChange)],this._uiSetEditorOpenAction(this.get(o)),this._setEditorOpenKeys(this.get("editorOpenKey"))},_unbindEditable:function(){this.hideEditor(!0),this._subscrEditable&&r(this._subscrEditable,function(e){e&&e.detach&&e.detach()}),this._subscrEditable=null,this._subscrEditOpen&&this._subscrEditOpen.detach(),this._subscrEditOpen=null,this._rowEditor&&(this._rowEditor.destroy(),this._rowEditor=null),this._destroyColumnEditors()},_uiSetEditable:function(e){e?(this._bindEditable(),this._buildColumnEditors()):(this._unbindEditable(),this._destroyColumnEditors())},_afterDefaultEditorChange:function(e){var t=e.newVal;t&&this.get(s)&&(this._uiSetEditable(!1),this._uiSetEditable(!0))},_uiSetColumns:function(){this.get(s)&&(this._uiSetEditable(!1),this._uiSetEditable(!0))},_uiSetEditorOpenAction:function(e){this._subscrEditOpen&&this._subscrEditOpen.detach(),e&&(this._subscrEditOpen=this.delegate(e,this._afterEditorOpenAction,"tbody."+this.getClassName("data")+" td",this))},_uiSetRowEditorOptions:function(){this._rowEditor.destroy(),this._rowEditor=null},_afterEditorOpenAction:function(e){e.halt(!0),this.get("rowEditor")?this.openRowEditor(e.currentTarget):this.openCellEditor(e.currentTarget)},_afterEditorOpenKeyChange:function(e){r(e.prevVal,function(e){delete this.keyActions[e]},this),e.newVal&&this._setEditorOpenKeys(e.newVal)},_setEditorOpenKeys:function(e){r(e,function(e){this.keyActions[e]="_afterEditorOpenKey"},this)},_afterEditorOpenKey:function(e){this.get("rowEditor")?this.openRowEditor(e.target):this.openCellEditor(e.target)},_buildColumnEditors:function(){var t=this.get(u),r,s;if(!e.DataTable.Editors)return;this._destroyColumnEditors(),this._commonEditors={},this._columnEditors={},i(this._columnMap,function(
i,o){var u=n.isObject(i.editorConfig),a=i.editorConfig||{};if(i.editable===!1||i.children||i.name&&i.name!==o)return;r=i.editor||t,r&&e.DataTable.Editors[r]&&(this._updateEditableColumnCSS(o,!0),i.lookupTable&&a.lookupTable===undefined&&(a.lookupTable=i.lookupTable,u=!0),u?(s=this._createCellEditorInstance(r,a),this._columnEditors[o]=s||null):(this._commonEditors[r]||(s=this._createCellEditorInstance(r,a),this._commonEditors[r]=s),this._columnEditors[o]=r))},this)},_createCellEditorInstance:function(t,n){var r=e.DataTable.Editors[t],i=null;return r&&(n.className=n.className||this.getClassName("celleditor",t),i=(new r(n)).render(this._editorsContainer),i.addTarget(this)),i},_destroyColumnEditors:function(){this._commonEditors&&i(this._commonEditors,function(e){e&&e instanceof S&&e.destroy({remove:!0})}),this._commonEditors=null,this._columnEditors&&i(this._columnEditors,function(e){e&&e instanceof S&&e.destroy({remove:!0})}),this._columnEditors=null,this._editorsContainer.empty(),this._tbodyNode&&this._tbodyNode.all("."+this._classColEditable).removeClass(this._classColEditable)},_afterEditableSort:function(){this.get(s)&&(this.hideEditor(!0),this._updateAllEditableColumnsCSS())},_updateAllEditableColumnsCSS:function(){var e=this.get(s);i(this._columnMap,function(t,n){t.children||t.name&&t.name!==n||this._updateEditableColumnCSS(n,e&&t.editable!==!1)},this)},_updateEditableColumnCSS:function(e,t){var n=this._tbodyNode;n&&n.all("td."+this.getClassName(c,e)).toggleClass(this._classColEditable,t)},_onScrollUpdateCellEditor:function(){var e=this._openEditor;e&&e.get("active")&&(e.set("visible",!this.isHidden(this._editorNode,!0)),e._attach(this._editorNode))},_afterClickOutside:function(){this.hideEditor()},_onKeyDown:function(e){var t=e.keyCode,n=0,r=0,i=this._openEditor;if(!i)return;switch(t){case d:if(i.get("saveOnEnterKey")){e.preventDefault(),i.saveEditor();return}break;case p:e.preventDefault(),i.cancelEditor();return}if(i.get("navigationEnabled")){switch(t){case m:r=e.ctrlKey?-1:0;break;case g:r=e.ctrlKey?1:0;break;case b:n=e.ctrlKey?-1:0;break;case y:n=e.ctrlKey?1:0;break;case v:n=e.shiftKey?-1:1}if(n||r)this._navigate(n,r),e.preventDefault()}},_navigate:function(e,t){var n=this._editorNode,r=n.get("cellIndex"),i=n.ancestor("tr"),s=i.ancestor("tbody"),o=i.get("rowIndex")-s.get("firstChild.rowIndex"),u=i.get("children").size(),f=s.get("children").size(),l=this.get(a),c=!1;if(!this.hideEditor())return;for(;;){o+=t,r+=e;if(r===u){if(!l||c)return;r=0,c=!0}else if(r<0){if(!l||c)return;r=u-1,c=!0}else if(o===f){if(!l||c)return;o=0,c=!0}else if(o<0){if(!l||c)return;o=f-1,c=!0}if(this.getColumn(r).editable!==!1){i=s.get("children").item(o),n=i.get("children").item(r),this.openCellEditor(n);return}}},_afterCellEditorCancel:function(){this._hideEditorCntd()},_afterRowEditorCancel:function(){this._hideEditorCntd()},_afterCellEditorSave:function(e){e.recordKey&&e.record.set(e.recordKey,e.newValue),this._hideEditorCntd()},_afterRowEditorSave:function(e){var t=e.record;i(e.values,function(e){e.recordKey&&t.set(e.recordKey,e.newValue)}),this._hideEditorCntd()}}),e.DataTable.Editable=w,e.Base.mix(e.DataTable,[w]),e.DataTable.Editors={};var E=function(e){return e},S=e.Base.create("celleditor",e.View,[],{_subscr:null,_formatter:E,_parser:E,_cellInfo:null,_classInput:"yui3-datatable-celleditor-input",_classError:"yui3-datatable-celleditor-error",_inputNode:null,_xyReference:null,_allowAdHocAttrs:!1,initializer:function(){this._subscr=[],this.publish({render:{defaultFn:this._defRenderFn},show:{defaultFn:this._defShowFn},save:{defaultFn:this._defSaveFn},cancel:{defaultFn:this._defCancelFn}})},destructor:function(){this.get("active")&&this.cancelEditor(),this._overlay&&this._overlay.destroy(),this._unbindUI()},render:function(t){var n=this.get("overlayConfig")||{};return this.get("popup")?(n.guest=this,n.buttons=this.get("buttons"),this._overlay=(new e.DataTable.CellEditorOverlay(n)).render(t),this.set("container",this._overlay.getStdModNode("body",!0))):t.append(this.get("container")),this.fire("render"),this._bindUI(),this},showEditor:function(t){this.fire("show",e.merge(t,{formattedValue:this._formatter(t.initialValue)}))},saveEditor:function(t,n){t===undefined&&(t=this._getValue());var r=this.get("validator"),i,s;if(r instanceof RegExp?r.test(t):!0){i=this._parser(t);if(i!==e.Attribute.INVALID_VALUE)return s=e.merge(this._cellInfo,{formattedValue:t,newValue:i}),n?(this._defSaveFn(s),!0):this.fire("save",s)}return this.get("container").addClass(this._classError),!1},cancelEditor:function(){return this.fire("cancel",this._cellInfo)},_defRenderFn:function(){var t=this.get("container"),n=this._classInput;t.setHTML(e.Lang.sub(this.get("template"),{classInput:n})),this._inputNode=t.one("."+n),this._xyReference=this._inputNode||t,t.addClass(this.get("className")+" yui3-datatable-celleditor"),this._overlay||t.hide()},_bindUI:function(){this._subscr=[this.after("visibleChange",this._afterVisibleChange)]},_unbindUI:function(){r(this._subscr,function(e){e&&e.detach&&e.detach()}),this._subscr=null},_defSaveFn:function(e){this.set("value",e.newValue),this._hideEditor()},_defCancelFn:function(){this._hideEditor()},_defShowFn:function(t){var n=this._cellInfo=t.details[0],r=this._inputNode;this.set("value",n.initialValue),this.set("visible",!0),this._attach(n.td),r instanceof e.Node&&r.focus().set("value",n.formattedValue).select(),this._set("active",!0)},_getValue:function(){if(this._inputNode)return this._inputNode.get("value")},_hideEditor:function(){this.set("visible",!1),this.get("container").removeClass(this._classError),this._cellInfo=null,this._set("active",!1)},_attach:function(e){if(this.get("visible")){var t=e.get("region");this._resize(t.width,t.height),this._move(t.left,t.top)}},_resize:function(e,t){var n=this._xyReference;n.set("offsetWidth",e+1),n.set("offsetHeight",t)},_move:function(e,t){(this._overlay||this._xyReference).setXY([e,t])},_afterVisibleChange:function(e){var t=this._overlay||this.get("container"
);t&&(e.newVal?t.show():t.hide())}},{localizedStrings:e.Intl.get("datatable-editable"),ATTRS:{template:{value:'<input class="{classInput}" type="text"  />',validator:n.isString},className:{validator:n.isString,value:""},value:{value:null},formatter:{value:E,lazyAdd:!1,setter:function(e){return this._formatter=typeof e=="function"?e:E,e}},parser:{value:E,lazyAdd:!1,setter:function(e){return this._parser=typeof e=="function"?e:E,e}},active:{value:!1,readOnly:!0,validator:n.isBoolean},visible:{value:!1,validator:n.isBoolean},validator:{value:null},saveOnEnterKey:{value:!0,validator:n.isBoolean},navigationEnabled:{value:!0,validator:n.isBoolean},popup:{value:!1,validator:n.isBoolean},overlayConfig:{value:{},validator:n.isObject},buttons:{value:null},title:{value:null}}});e.DataTable.BaseCellEditor=S;var x=e.Lang.sub,T=e.Plugins||{},N=e.Array.map;e.DataTable.CellEditorOverlay=e.Base.create("celleditor-overlay",e.Overlay,[],{btnTemplate:'<button class="yui3-button {classButton}">{label}</button>',_guest:null,_offsetX:null,_offsetY:null,initializer:function(e){var t=this._guest=e.guest,n=t.get("title");T.Drag&&this.plug(T.Drag),n&&this.set("headerContent",n),this._createOverlayButtons(t.get("buttons"))},_createOverlayButtons:function(t){var n=e.DataTable.BaseCellEditor.localizedStrings,r,i;t&&(i=N(t,function(e){return x(this.btnTemplate,{classButton:(e.className||"")+(e.save?" yui3-button-primary":""),label:e.label||(e.save?n.save:e.cancel?n.cancel:"unknown label")})},this),this.set("footerContent",i.join("\n")),r=this.getStdModNode("footer",!0),this._guest._subscr.push(r.delegate("click",this._afterButtonClick,"button.yui3-button",this)))},_afterButtonClick:function(t){var r=null,i,s,o=this._guest;if(t.target.ancestor().get("children").some(function(e,n){if(e===t.target)return r=o.get("buttons")[n],!0})){if(r.save){o.saveEditor();return}if(r.cancel){o.cancelEditor();return}i=r.action,s=e.merge(o._cellInfo,{value:o._getValue()});switch(n.type(i)){case"string":o[i]?o[i].call(o,r,s):o.fire(i,r,s);break;case"function":i.call(o,r,s)}}},setXY:function(e){var t=this._offsetX,n,r,i=this._guest;t===null&&(n=this.get("boundingBox").getXY(),r=i._xyReference.getXY(),t=this._offsetX=n[0]-r[0],this._offsetY=n[1]-r[1]),this.set("xy",[e[0]+t,e[1]+this._offsetY])}},{ATTRS:{zIndex:{value:99},visible:{value:!1}}}),e.DataTable.RowEditor=e.Base.create("roweditor",e.Overlay,[],{btnTemplate:'<button class="yui3-button {classButton}">{label}</button>',_dt:null,_offsetX:null,_offsetY:null,_rowInfo:null,initializer:function(e){this._subscr=[];var t=e.title;this._dt=e.dt,t&&this.set("headerContent",t),this._createOverlayButtons(e.buttons),this.publish({show:{defaultFn:this._defShowFn},save:{defaultFn:this._defSaveFn},cancel:{defaultFn:this._defCancelFn}})},destructor:function(){r(this._subscr,function(e){e.detach&&e.detach()})},showEditor:function(e){return this.fire("show",e)},_defShowFn:function(t){var n=this._dt,r=t.tr,s="."+n.getClassName("col")+"-",o=t.record,u=t.focusOn.name,a=e.DataTable.Core._sanitizeId;this._rowInfo={tr:r,record:o},this.show(),this._set("active",!0),this._attach(r),i(n._columnEditors,function(e,t){var i=n._columnMap[t].key;u===t&&(u=e),e.showEditor({colName:t,td:r.one(s+a(t)),recordKey:i,initialValue:o.get(i),record:o})},this),u._inputNode&&u._inputNode.focus()},_createOverlayButtons:function(t){var n=e.DataTable.BaseCellEditor.localizedStrings,r,i;t&&(i=N(t,function(e){return x(this.btnTemplate,{classButton:(e.className||"")+(e.save?" yui3-button-primary":""),label:e.label||(e.save?n.save:e.cancel?n.cancel:"unknown label")})},this),this.set("footerContent",i.join("\n")),r=this.getStdModNode("footer",!0),this._subscr.push(r.delegate("click",this._afterButtonClick,"button.yui3-button",this)))},_afterButtonClick:function(t){var r=null,s,o,u={},a=this._dt;if(t.target.ancestor().get("children").some(function(e,n){if(e===t.target)return r=this.get("buttons")[n],!0},this)){if(r.save){this.saveEditor();return}if(r.cancel){this.cancelEditor();return}s=r.action,i(this._dt._columnEditors,function(e,t){var n=e._cellInfo,r={td:n.td,initialValue:n.initialValue,recordKey:n.recordKey,value:e._getValue()};u[t]=r}),o=e.merge(this._rowInfo,{values:u});switch(n.type(s)){case"string":a[s]?a[s].call(a,r,o):a.fire(s,r,o);break;case"function":s.call(a,r,o)}}},saveEditor:function(){var t=!0,n={};return i(this._dt._columnEditors,function(e,r){var i=e._cellInfo,s={td:i.td,initialValue:i.initialValue,recordKey:i.recordKey};t=t&&e.saveEditor(undefined,!0),s.newValue=e.get("value"),n[r]=s}),t&&this.fire("save",e.merge(this._rowInfo,{values:n})),t},_defSaveFn:function(){this._hideEditor()},cancelEditor:function(){return this.fire("cancel",this._rowInfo)},_defCancelFn:function(){this._hideEditor()},_hideEditor:function(){i(this._dt._columnEditors,function(e){e._hideEditor()}),this._set("active",!1),this.hide()},_attach:function(e){if(this.get("visible")){var t=e.get("region");this._resize(t.width,t.height),this._move(t.left,t.top)}},_resize:function(e,t){var n=this.getStdModNode("body",!0);n.set("offsetWidth",e+1),n.set("offsetHeight",t)},_move:function(e,t){var n=this._offsetX,r,i;n===null&&(r=this.get("boundingBox").getXY(),i=this.getStdModNode("body",!0).getXY(),n=this._offsetX=r[0]-i[0],this._offsetY=r[1]-i[1]),this.set("xy",[e+n,t+this._offsetY])}},{ATTRS:{zIndex:{value:97},visible:{value:!1},buttons:{},active:{value:!1,readOnly:!0,validator:n.isBoolean}}})},"@VERSION@",{skinnable:"true",lang:["en","es"],requires:["datatable-base","datatype","node-screen","datatable-keynav","event-resize","event-outside","overlay","dd-plugin"]});
