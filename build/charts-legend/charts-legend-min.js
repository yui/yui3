YUI.add("charts-legend",function(a,e){var c=a.config.doc,q="top",i="right",g="bottom",k="left",t="external",v="horizontal",r="vertical",b="width",o="height",n="position",j="x",h="y",f="px",m={setter:function(x){var w=this.get("legend");if(w){w.destroy(true);}if(x instanceof a.ChartLegend){w=x;w.set("chart",this);}else{x.chart=this;if(!x.hasOwnProperty("render")){x.render=this.get("contentBox");x.includeInChartLayout=true;}w=new a.ChartLegend(x);}return w;}},u={_positionLegendItems:function(L,U,O,x,Y,I,F,B,R,H){var S=0,M=0,W,P,z,Q,T,N=this.get("width"),G,E,A,D,K,w=I.top-B,V=N-(I.left+I.right),y,J,X,C;u._setRowArrays(L,V,F);G=u.rowArray;D=u.totalWidthArray;E=G.length;for(;M<E;++M){w+=B;A=G[M];T=A.length;K=u.getStartPoint(N,D[M],R,I);for(S=0;S<T;++S){W=A[S];P=W.node;z=W.width;Q=W.height;W.x=K;W.y=0;y=!isNaN(y)?Math.min(y,K):K;J=!isNaN(J)?Math.min(J,w):w;X=!isNaN(X)?Math.max(K+z,X):K+z;C=!isNaN(C)?Math.max(w+Q,C):w+Q;P.setStyle("left",K+f);P.setStyle("top",w+f);K+=z+F;}w+=W.height;}this._contentRect={left:y,top:J,right:X,bottom:C};if(this.get("includeInChartLayout")){this.set("height",w+I.bottom);}},_setRowArrays:function(C,w,E){var G=C[0],D=[[G]],y=1,x=0,A=C.length,z=G.width,B,F=[[z]];for(;y<A;++y){G=C[y];B=G.width;if((z+E+B)<=w){z+=E+B;D[x].push(G);}else{z=E+B;if(D[x]){x+=1;}D[x]=[G];}F[x]=z;}u.rowArray=D;u.totalWidthArray=F;},getStartPoint:function(y,x,B,A){var z;switch(B){case k:z=A.left;break;case"center":z=(y-x)*0.5;break;case i:z=y-x-A.right;break;}return z;}},p={_positionLegendItems:function(N,U,O,y,Y,J,F,D,R,H){var S=0,G=0,W,P,Q,C,T,M=this.get("height"),w,z,x,I,B,Z=J.left-F,L,V=M-(J.top+J.bottom),A,K,X,E;p._setColumnArrays(N,V,D);w=p.columnArray;I=p.totalHeightArray;z=w.length;for(;G<z;++G){Z+=F;x=w[G];T=x.length;B=p.getStartPoint(M,I[G],H,J);L=0;for(S=0;S<T;++S){W=x[S];P=W.node;Q=W.height;C=W.width;W.y=B;W.x=Z;A=!isNaN(A)?Math.min(A,Z):Z;K=!isNaN(K)?Math.min(K,B):B;X=!isNaN(X)?Math.max(Z+C,X):Z+C;E=!isNaN(E)?Math.max(B+Q,E):B+Q;P.setStyle("left",Z+f);P.setStyle("top",B+f);B+=Q+D;L=Math.max(L,W.width);}Z+=L;}this._contentRect={left:A,top:K,right:X,bottom:E};if(this.get("includeInChartLayout")){this.set("width",Z+J.right);}},_setColumnArrays:function(D,y,A){var G=D[0],E=[[G]],z=1,w=0,B=D.length,C=G.height,x,F=[[C]];for(;z<B;++z){G=D[z];x=G.height;if((C+A+x)<=y){C+=A+x;E[w].push(G);}else{C=A+x;if(E[w]){w+=1;}E[w]=[G];}F[w]=C;}p.columnArray=E;p.totalHeightArray=F;},getStartPoint:function(x,w,A,z){var y;switch(A){case q:y=z.top;break;case"middle":y=(x-w)*0.5;break;case g:y=x-w-z.bottom;break;}return y;}},d=a.Base.create("cartesianChartLegend",a.CartesianChart,[],{_redraw:function(){if(this._drawing){this._callLater=true;return;}this._drawing=true;this._callLater=false;var M=this.get("width"),W=this.get("height"),E=this._getLayoutBoxDimensions(),U=E.left,D=E.right,aa=E.top,y=E.bottom,x=this.get("leftAxesCollection"),K=this.get("rightAxesCollection"),L=this.get("topAxesCollection"),Z=this.get("bottomAxesCollection"),V=0,S,F,B="visible",C=this.get("graph"),H,N,T,R,I,J,Y,X,Q=this.get("allowContentOverflow"),O,z,ac,P,G,A=this.get("legend"),ab={};if(x){ac=[];S=x.length;for(V=S-1;V>-1;--V){ac.unshift(U);U+=x[V].get("width");}}if(K){z=[];S=K.length;V=0;for(V=S-1;V>-1;--V){D+=K[V].get("width");z.unshift(M-D);}}if(L){P=[];S=L.length;for(V=S-1;V>-1;--V){P.unshift(aa);aa+=L[V].get("height");}}if(Z){G=[];S=Z.length;for(V=S-1;V>-1;--V){y+=Z[V].get("height");G.unshift(W-y);}}I=M-(U+D);J=W-(y+aa);ab.left=U;ab.top=aa;ab.bottom=W-y;ab.right=M-D;if(!Q){H=this._getTopOverflow(x,K);N=this._getBottomOverflow(x,K);T=this._getLeftOverflow(Z,L);R=this._getRightOverflow(Z,L);O=H-aa;if(O>0){ab.top=H;if(P){V=0;S=P.length;for(;V<S;++V){P[V]+=O;}}}O=N-y;if(O>0){ab.bottom=W-N;if(G){V=0;S=G.length;for(;V<S;++V){G[V]-=O;}}}O=T-U;if(O>0){ab.left=T;if(ac){V=0;S=ac.length;for(;V<S;++V){ac[V]+=O;}}}O=R-D;if(O>0){ab.right=M-R;if(z){V=0;S=z.length;for(;V<S;++V){z[V]-=O;}}}}I=ab.right-ab.left;J=ab.bottom-ab.top;Y=ab.left;X=ab.top;if(A){if(A.get("includeInChartLayout")){switch(A.get("position")){case"left":A.set("y",X);A.set("height",J);break;case"top":A.set("x",Y);A.set("width",I);break;case"bottom":A.set("x",Y);A.set("width",I);break;case"right":A.set("y",X);A.set("height",J);break;}}}if(L){S=L.length;V=0;for(;V<S;V++){F=L[V];if(F.get("width")!==I){F.set("width",I);}F.get("boundingBox").setStyle("left",Y+f);F.get("boundingBox").setStyle("top",P[V]+f);}if(F._hasDataOverflow()){B="hidden";}}if(Z){S=Z.length;V=0;for(;V<S;V++){F=Z[V];if(F.get("width")!==I){F.set("width",I);}F.get("boundingBox").setStyle("left",Y+f);F.get("boundingBox").setStyle("top",G[V]+f);}if(F._hasDataOverflow()){B="hidden";}}if(x){S=x.length;V=0;for(;V<S;++V){F=x[V];F.get("boundingBox").setStyle("top",X+f);F.get("boundingBox").setStyle("left",ac[V]+f);if(F.get("height")!==J){F.set("height",J);}}if(F._hasDataOverflow()){B="hidden";}}if(K){S=K.length;V=0;for(;V<S;++V){F=K[V];F.get("boundingBox").setStyle("top",X+f);F.get("boundingBox").setStyle("left",z[V]+f);if(F.get("height")!==J){F.set("height",J);}}if(F._hasDataOverflow()){B="hidden";}}this._drawing=false;if(this._callLater){this._redraw();return;}if(C){C.get("boundingBox").setStyle("left",Y+f);C.get("boundingBox").setStyle("top",X+f);C.set("width",I);C.set("height",J);C.get("boundingBox").setStyle("overflow",B);}if(this._overlay){this._overlay.setStyle("left",Y+f);this._overlay.setStyle("top",X+f);this._overlay.setStyle("width",I+f);this._overlay.setStyle("height",J+f);}},_getLayoutBoxDimensions:function(){var y={top:0,right:0,bottom:0,left:0},D=this.get("legend"),A,C,x,F,E=this.get(b),z=this.get(o),B;if(D&&D.get("includeInChartLayout")){B=D.get("styles").gap;A=D.get(n);if(A!=t){C=D.get("direction");x=C==v?o:b;F=D.get(x);y[A]=F+B;switch(A){case q:D.set(h,0);break;case g:D.set(h,z-F);break;case i:D.set(j,E-F);break;case k:D.set(j,0);break;}}}return y;},destructor:function(){var w=this.get("legend");if(w){w.destroy(true);}}},{ATTRS:{legend:m}});a.CartesianChart=d;var l=a.Base.create("pieChartLegend",a.PieChart,[],{_redraw:function(){if(this._drawing){this._callLater=true;
return;}this._drawing=true;this._callLater=false;var O=this.get("graph"),L=this.get("width"),C=this.get("height"),N,z,K=this.get("legend"),I=0,F=0,E=0,D=0,M,J,A,H,B,G;if(O){if(K){B=K.get("position");G=K.get("direction");N=O.get("width");z=O.get("height");M=K.get("width");J=K.get("height");H=K.get("styles").gap;if((G=="vertical"&&(N+M+H!==L))||(G=="horizontal"&&(z+J+H!==C))){switch(K.get("position")){case k:A=Math.min(L-(M+H),C);J=C;I=M+H;K.set(o,J);break;case q:A=Math.min(C-(J+H),L);M=L;F=J+H;K.set(b,M);break;case i:A=Math.min(L-(M+H),C);J=C;E=A+H;K.set(o,J);break;case g:A=Math.min(C-(J+H),L);M=L;D=A+H;K.set(b,M);break;}O.set(b,A);O.set(o,A);}else{switch(K.get("position")){case k:I=M+H;break;case q:F=J+H;break;case i:E=N+H;break;case g:D=z+H;break;}}}else{O.set(j,0);O.set(h,0);O.set(b,L);O.set(o,C);}}this._drawing=false;if(this._callLater){this._redraw();return;}if(O){O.set(j,I);O.set(h,F);}if(K){K.set(j,E);K.set(h,D);}}},{ATTRS:{legend:m}});a.PieChart=l;a.ChartLegend=a.Base.create("chartlegend",a.Widget,[a.Renderer],{initializer:function(){this._items=[];},renderUI:function(){var z=this.get("boundingBox"),w=this.get("contentBox"),y=this.get("styles").background,x=new a.Rect({graphic:w,fill:y.fill,stroke:y.border});z.setStyle("display","block");z.setStyle("position","absolute");this.set("background",x);},bindUI:function(){this.get("chart").after("seriesCollectionChange",a.bind(this._updateHandler,this));this.after("stylesChange",this._updateHandler);this.after("positionChange",this._positionChangeHandler);this.after("widthChange",this._handleSizeChange);this.after("heightChange",this._handleSizeChange);},syncUI:function(){var x=this.get("width"),y=this.get("height");if(isFinite(x)&&isFinite(y)&&x>0&&y>0){this._drawLegend();}},_updateHandler:function(w){if(this.get("rendered")){this._drawLegend();}},_positionChangeHandler:function(y){var x=this.get("chart"),w=this._parentNode;if(w&&((x&&this.get("includeInChartLayout")))){this.fire("legendRendered");}else{if(this.get("rendered")){this._drawLegend();}}},_handleSizeChange:function(y){var x=y.attrName,A=this.get(n),w=A==k||A==i,z=A==g||A==q;if((z&&x==b)||(w&&x==o)){this._drawLegend();}},_drawLegend:function(){if(this._drawing){this._callLater=true;return;}this._drawing=true;this._callLater=false;if(this.get("includeInChartLayout")){this.get("chart")._itemRenderQueue.unshift(this);}var ae=this.get("chart"),W=this.get("contentBox"),X=ae.get("seriesCollection"),B,T=this.get("styles"),aa=T.padding,M=T.item,Y,A=M.hSpacing,C=M.vSpacing,G=T.hAlign,P=T.vAlign,af=T.marker,I=M.label,U,V=this._layout[this.get("direction")],ab,J,O,K,E,S,H,F,ac,x,w,L=[],R=af.width,y=af.height,D=0-A,Q=0-C,N=0,Z=0,z,ad;if(af&&af.shape){K=af.shape;}this._destroyLegendItems();if(ae instanceof a.PieChart){B=X[0];U=B.get("categoryAxis").getDataByKey(B.get("categoryKey"));Y=B.get("styles").marker;ac=Y.fill.colors;x=Y.border.colors;w=Y.border.weight;ab=0;J=U.length;K=K||a.Circle;O=a.Lang.isArray(K);for(;ab<J;++ab){K=O?K[ab]:K;H={color:ac[ab]};F={colors:x[ab],weight:w};U=ae.getSeriesItems(B,ab).category.value;S=this._getLegendItem(W,this._getShapeClass(K),H,F,I,R,y,U);z=S.width;ad=S.height;N=Math.max(N,z);Z=Math.max(Z,ad);D+=z+A;Q+=ad+C;L.push(S);}}else{ab=0;J=X.length;for(;ab<J;++ab){B=X[ab];Y=this._getStylesBySeriesType(B,K);if(!K){K=Y.shape;if(!K){K=a.Circle;}}E=a.Lang.isArray(K)?K[ab]:K;S=this._getLegendItem(W,this._getShapeClass(K),Y.fill,Y.border,I,R,y,B.get("valueDisplayName"));z=S.width;ad=S.height;N=Math.max(N,z);Z=Math.max(Z,ad);D+=z+A;Q+=ad+C;L.push(S);}}this._drawing=false;if(this._callLater){this._drawLegend();}else{V._positionLegendItems.apply(this,[L,N,Z,D,Q,aa,A,C,G,P]);this._updateBackground(T);this.fire("legendRendered");}},_updateBackground:function(D){var E=D.background,A=this._contentRect,F=D.padding,z=A.left-F.left,G=A.top-F.top,B=A.right-z+F.right,C=A.bottom-G+F.bottom;this.get("background").set({fill:E.fill,stroke:E.border,width:B,height:C,x:z,y:G});},_getStylesBySeriesType:function(x){var y=x.get("styles"),w;if(x instanceof a.LineSeries||x instanceof a.StackedLineSeries){y=x.get("styles").line;w=y.color||x._getDefaultColor(x.get("graphOrder"),"line");return{border:{weight:1,color:w},fill:{color:w}};}else{if(x instanceof a.AreaSeries||x instanceof a.StackedAreaSeries){y=x.get("styles").area;w=y.color||x._getDefaultColor(x.get("graphOrder"),"slice");return{border:{weight:1,color:w},fill:{color:w}};}else{y=x.get("styles").marker;return{fill:y.fill,border:{weight:y.border.weight,color:y.border.color,shape:y.shape},shape:y.shape};}}},_getLegendItem:function(y,F,L,B,G,I,D,J){var A=a.one(c.createElement("div")),z=a.one(c.createElement("span")),E,C,H,x,K;A.setStyle(n,"absolute");z.setStyle(n,"absolute");z.setStyles(G);z.appendChild(c.createTextNode(J));A.appendChild(z);y.appendChild(A);C=z.get("offsetHeight");H=C-D;x=I+H+2;z.setStyle("left",x+f);A.setStyle("height",C+f);A.setStyle("width",(x+z.get("offsetWidth"))+f);E=new F({fill:L,stroke:B,width:I,height:D,x:H*0.5,y:H*0.5,w:I,h:D,graphic:A});z.setStyle("left",C+f);K={node:A,width:A.get("offsetWidth"),height:A.get("offsetHeight"),shape:E,textNode:z,text:J};this._items.push(K);return K;},_getShapeClass:function(){var w=this.get("background").get("graphic");return w._getShapeClass.apply(w,arguments);},_getDefaultStyles:function(){var w={padding:{top:8,right:8,bottom:8,left:9},gap:10,hAlign:"center",vAlign:"top",marker:this._getPlotDefaults(),item:{hSpacing:10,vSpacing:5,label:{color:"#808080",fontSize:"85%",whiteSpace:"nowrap"}},background:{shape:"rect",fill:{color:"#faf9f2"},border:{color:"#dad8c9",weight:1}}};return w;},_getPlotDefaults:function(){var w={width:10,height:10};return w;},_destroyLegendItems:function(){var w;if(this._items){while(this._items.length>0){w=this._items.shift();w.shape.get("graphic").destroy();w.node.empty();w.node.destroy(true);w.node=null;w=null;}}this._items=[];},_layout:{vertical:p,horizontal:u},destructor:function(){var w=this.get("background"),x;this._destroyLegendItems();if(w){x=w.get("graphic");
if(x){x.destroy();}else{w.destroy();}}}},{ATTRS:{includeInChartLayout:{value:false},chart:{setter:function(w){this.after("legendRendered",a.bind(w._itemRendered,w));return w;}},direction:{value:"vertical"},position:{lazyAdd:false,value:"right",setter:function(w){if(w==q||w==g){this.set("direction",v);}else{if(w==k||w==i){this.set("direction",r);}}return w;}},width:{getter:function(){var x=this.get("chart"),w=this._parentNode;if(w){if((x&&this.get("includeInChartLayout"))||this._width){if(!this._width){this._width=0;}return this._width;}else{return w.get("offsetWidth");}}return"";},setter:function(w){this._width=w;return w;}},height:{valueFn:"_heightGetter",getter:function(){var x=this.get("chart"),w=this._parentNode;if(w){if((x&&this.get("includeInChartLayout"))||this._height){if(!this._height){this._height=0;}return this._height;}else{return w.get("offsetHeight");}}return"";},setter:function(w){this._height=w;return w;}},x:{lazyAdd:false,value:0,setter:function(x){var w=this.get("boundingBox");if(w){w.setStyle(k,x+f);}return x;}},y:{lazyAdd:false,value:0,setter:function(x){var w=this.get("boundingBox");if(w){w.setStyle(q,x+f);}return x;}},items:{getter:function(){return this._items;}},background:{}}});function s(w){if(w.type!="pie"){return new a.CartesianChart(w);}else{return new a.PieChart(w);}}a.Chart=s;},"@VERSION@",{"requires":["charts-base"]});