YUI.add("history-base",function(B){var F=B.Lang,D=B.Object,H=YUI.namespace("Env.History"),G="change",I="historyBase",A="add",E="replace",C=function(){this._init.apply(this,arguments);};B.augment(C,B.EventTarget,null,null,{emitFacade:true,prefix:"history",preventable:false,queueable:true});if(!H._state){H._state={};}C.NAME=I;C.SRC_ADD=A;C.SRC_REPLACE=E;B.mix(C.prototype,{_init:function(K){var J=K&&K.initialState;this.publish(G,{broadcast:2,defaultFn:this._defChangeFn});if(F.isObject(J)&&!F.isFunction(J)&&!F.isArray(J)){this.add(B.merge(H._state,J));}},add:function(K,J){return this._change(A,K,J);},get:function(J){var K=H._state;if(J){return D.owns(K,J)?K[J]:undefined;}else{return B.mix({},K,true);}},replace:function(K,J){return this._change(E,K,J);},_change:function(M,L,K){var J;if(F.isString(L)){J=L;L={};L[J]=K;}this._resolveChanges(M,B.merge(H._state,L));return this;},_fireEvents:function(K,J){this.fire(G,{changed:J.changed,newVal:J.newState,prevVal:J.prevState,removed:J.removed,src:K});D.each(J.changed,function(M,L){this._fireChangeEvent(K,L,M);},this);D.each(J.removed,function(M,L){this._fireRemoveEvent(K,L,M);},this);},_fireChangeEvent:function(L,J,K){this.fire(J+"Change",{newVal:K.newVal,prevVal:K.prevVal,src:L});},_fireRemoveEvent:function(L,J,K){this.fire(J+"Remove",{prevVal:K,src:L});},_resolveChanges:function(O,M){var N={},J,L=H._state,K={};M=M||{};D.each(M,function(P,Q){var R=L[Q];if(P!==R){N[Q]={newVal:P,prevVal:R};J=true;}},this);D.each(L,function(Q,P){if(!D.owns(M,P)||M[P]===null){delete M[P];K[P]=Q;J=true;}},this);if(J){this._fireEvents(O,{changed:N,newState:M,prevState:L,removed:K});}},_storeState:function(K,J){H._state=J||{};},_defChangeFn:function(J){this._storeState(J.src,J.newVal);}},true);B.HistoryBase=C;},"@VERSION@",{requires:["event-custom-complex"]});