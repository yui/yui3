YUI.add("model",function(a){var g=YUI.namespace("Env.Model"),d=a.Lang,i=a.Array,f=a.Object,e="change",c="error";function h(){this._events=[];}h.prototype.end=function(){var k=[],j,m,l;a.each(this._events,function(n){j=n.target;j.lastChange={};});a.each(this._events,function(n){j=n.target;j.changed[n.attrName]=n.newVal;j.lastChange[n.attrName]={newVal:n.newVal,prevVal:n.prevVal,src:n.src||null};});a.each(this._events,function(n){j=n.target;if(!n.silent&&i.indexOf(k,j)===-1){if(!j._changeEvent){j._changeEvent=j.publish(e,{preventable:false});}j.fire(e,{changed:j.lastChange});k.push(j);}},this);};a.Transaction=h;function b(){b.superclass.constructor.apply(this,arguments);}a.Model=a.extend(b,a.Base,{idAttribute:"id",initializer:function(j){this.changed={};this.lastChange={};this.lists=[];},destroy:function(k,m){var j=this;if(typeof k==="function"){m=k;k={};}function l(n){if(!n){i.each(j.lists,function(o){o.remove(j,k);});b.superclass.destroy.call(j);}m&&m.apply(null,arguments);}if(k&&k["delete"]){this.sync("delete",k,l);}else{l();}return this;},generateClientId:function(){g.lastId||(g.lastId=0);return this.constructor.NAME+"_"+(g.lastId+=1);},getAsHTML:function(j){var k=this.get(j);return a.Escape.html(d.isValue(k)?String(k):"");},getAsURL:function(j){var k=this.get(j);return encodeURIComponent(d.isValue(k)?String(k):"");},isModified:function(){return this.isNew()||!f.isEmpty(this.changed);},isNew:function(){return !d.isValue(this.get("id"));},load:function(k,l){var j=this;if(typeof k==="function"){l=k;k={};}this.sync("read",k,function(n,m){if(!n){j.setAttrs(j.parse(m),k);j.changed={};}l&&l.apply(null,arguments);});return this;},parse:function(j){if(typeof j==="string"){try{return a.JSON.parse(j);}catch(k){this.fire(c,{error:k,response:j,src:"parse"});return null;}}return j;},save:function(k,l){var j=this;if(typeof k==="function"){l=k;k={};}this.sync(this.isNew()?"create":"update",k,function(n,m){if(!n){if(m){j.setAttrs(j.parse(m),k);}j.changed={};}l&&l.apply(null,arguments);});return this;},set:function(l,m,k){var j={};j[l]=m;return this.setAttrs(j,k);},setAttrs:function(l,r){var p=this.idAttribute,j=false,m,o,q,n,k;if(!this._validate(l)){return this;}r||(r={});if(!d.isValue(r.transaction)){r.transaction=new h(r);j=true;}k=r.transaction;if(p!=="id"){l=a.merge(l);if(f.owns(l,p)){l.id=l[p];}else{if(f.owns(l,"id")){l[p]=l.id;}}}for(q in l){if(f.owns(l,q)){this._setAttr(q,l[q],r);}}if(j){k.end();}return this;},sync:function(){var j=i(arguments,0,true).pop();if(typeof j==="function"){j();}},toJSON:function(){var j=this.getAttrs();delete j.clientId;delete j.destroyed;delete j.initialized;if(this.idAttribute!=="id"){delete j.id;}return j;},undo:function(o,k){var n=this.lastChange,m=this.idAttribute,j={},l;o||(o=f.keys(n));i.each(o,function(p){if(f.owns(n,p)){p=p===m?"id":p;l=true;j[p]=n[p].prevVal;}});return l?this.setAttrs(j,k):this;},validate:function(){},addAttr:function(k,j,m){var n=this.idAttribute,l,o;if(n&&k===n){l=this._isLazyAttr("id")||this._getAttrCfg("id");o=j.value===j.defaultValue?null:j.value;if(!d.isValue(o)){o=l.value===l.defaultValue?null:l.value;if(!d.isValue(o)){o=d.isValue(j.defaultValue)?j.defaultValue:l.defaultValue;}}j.value=o;if(l.value!==o){l.value=o;if(this._isLazyAttr("id")){this._state.add("id","lazy",l);}else{this._state.add("id","value",o);}}}return b.superclass.addAttr.apply(this,arguments);},_validate:function(j){var k=this.validate(j);if(d.isValue(k)){this.fire(c,{attributes:j,error:k,src:"validate"});return false;}return true;},_defAttrChangeFn:function(k){var j=k.attrName;if(!this._setAttrVal(j,k.subAttrName,k.prevVal,k.newVal)){k.stopImmediatePropagation();}else{k.newVal=this.get(j);if(k.transaction){k.transaction._events.push(k);}}}},{NAME:"model",ATTRS:{clientId:{valueFn:"generateClientId",readOnly:true},id:{value:null}}});},"@VERSION@",{requires:["base-build","escape","json-parse"]});