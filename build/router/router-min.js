YUI.add("router",function(b,k){var g=b.HistoryHash,d=b.QueryString,i=b.Array,j=b.Lang,f=b.config.win,a=[],h=[],e="ready";function c(){c.superclass.constructor.apply(this,arguments);}b.Router=b.extend(c,b.Base,{_regexPathParam:/([:*])([\w\-]+)?/g,_regexUrlQuery:/\?([^#]*).*$/,_regexUrlOrigin:/^(?:[^\/#?:]+:\/\/|\/\/)[^\/]*/,initializer:function(m){var l=this;l._html5=l.get("html5");l._routes=[];l._url=l._getURL();l._setRoutes(m&&m.routes?m.routes:l.get("routes"));if(l._html5){l._history=new b.HistoryHTML5({force:true});l._historyEvents=b.after("history:change",l._afterHistoryChange,l);}else{l._historyEvents=b.on("hashchange",l._afterHistoryChange,f,l);}l.publish(e,{defaultFn:l._defReadyFn,fireOnce:true,preventable:false});l.once("initializedChange",function(){b.once("load",function(){setTimeout(function(){l.fire(e,{dispatched:!!l._dispatched});},20);});});a.push(this);},destructor:function(){var l=i.indexOf(a,this);if(l>-1){a.splice(l,1);}this._historyEvents&&this._historyEvents.detach();},dispatch:function(){this.once(e,function(){this._ready=true;if(this._html5&&this.upgrade()){return;}else{this._dispatch(this._getPath(),this._getURL());}});return this;},getPath:function(){return this._getPath();},hasRoute:function(l){var m;if(!this._hasSameOrigin(l)){return false;}if(!this._html5){l=this._upgradeURL(l);}m=this.removeQuery(this.removeRoot(l));return !!this.match(m).length;},match:function(l){return i.filter(this._routes,function(m){return l.search(m.regex)>-1;});},removeRoot:function(m){var l=this.get("root");m=m.replace(this._regexUrlOrigin,"");if(l&&m.indexOf(l)===0){m=m.substring(l.length);}return m.charAt(0)==="/"?m:"/"+m;},removeQuery:function(l){return l.replace(/\?.*$/,"");},replace:function(l){return this._queue(l,true);},route:function(n,m){m=i.flatten(i(arguments,1,true));var l=[];this._routes.push({callbacks:m,keys:l,path:n,regex:this._getRegex(n,l),callback:m[0]});return this;},save:function(l){return this._queue(l);},upgrade:function(){if(!this._html5){return false;}var l=this._getHashPath();if(l){this.once(e,function(){this.replace(l);});return true;}return false;},_decode:function(l){return decodeURIComponent(l.replace(/\+/g," "));},_dequeue:function(){var l=this,m;if(!YUI.Env.windowLoaded){b.once("load",function(){l._dequeue();});return this;}m=h.shift();return m?m():this;},_dispatch:function(t,m,l){var s=this,r=s.match(t),o=[],n,q,p;s._dispatching=s._dispatched=true;if(!r||!r.length){s._dispatching=false;return s;}q=s._getRequest(t,m,l);p=s._getResponse(q);q.next=function(v){var w,u;if(v){if(v==="route"){o=[];q.next();}else{b.error(v);}}else{if((w=o.shift())){if(typeof w==="string"){w=s[w];}q.pendingCallbacks=o.length;w.call(s,q,p,q.next);}else{if((u=r.shift())){o=u.callbacks.concat();n=u.regex.exec(t);if(n.length===u.keys.length+1){q.params=i.hash(u.keys,n.slice(1));}else{q.params=n.concat();}q.pendingRoutes=r.length;q.next();}}}};q.next();s._dispatching=false;return s._dequeue();},_getHashPath:function(l){l||(l=g.getHash());if(l&&l.charAt(0)==="/"){return this._joinURL(l);}return"";},_getOrigin:function(){var l=b.getLocation();return l.origin||(l.protocol+"//"+l.host);},_getPath:function(){var l=(!this._html5&&this._getHashPath())||b.getLocation().pathname;return this.removeQuery(this.removeRoot(l));},_getPathRoot:function(){var m="/",n=b.getLocation().pathname,l;if(n.charAt(n.length-1)===m){return n;}l=n.split(m);l.pop();return l.join(m)+m;},_getQuery:function(){var l=b.getLocation(),n,m;if(this._html5){return l.search.substring(1);}n=g.getHash();m=n.match(this._regexUrlQuery);return n&&m?m[1]:l.search.substring(1);},_getRegex:function(m,l){if(m instanceof RegExp){return m;}if(m==="*"){return(/.*/);}m=m.replace(this._regexPathParam,function(o,n,p){if(!p){return n==="*"?".*":o;}l.push(p);return n==="*"?"(.*?)":"([^/#?]*)";});return new RegExp("^"+m+"$");},_getRequest:function(m,l,n){return{path:m,query:this._parseQuery(this._getQuery()),url:l,src:n};},_getResponse:function(m){var l=function(){return m.next.apply(this,arguments);};l.req=m;return l;},_getRoutes:function(){return this._routes.concat();},_getURL:function(){var l=b.getLocation().toString();if(!this._html5){l=this._upgradeURL(l);}return l;},_hasSameOrigin:function(m){var l=((m&&m.match(this._regexUrlOrigin))||[])[0];if(l&&l.indexOf("//")===0){l=b.getLocation().protocol+l;}return !l||l===this._getOrigin();},_joinURL:function(m){var l=this.get("root");m=this.removeRoot(m);if(m.charAt(0)==="/"){m=m.substring(1);}return l&&l.charAt(l.length-1)==="/"?l+m:l+"/"+m;},_normalizePath:function(t){var q="..",l="/",m,p,s,n,o,r;if(!t||t===l){return l;}n=t.split(l);r=[];for(m=0,p=n.length;m<p;++m){o=n[m];if(o===q){r.pop();}else{if(o){r.push(o);}}}s=l+r.join(l);if(s!==l&&t.charAt(t.length-1)===l){s+=l;}return s;},_parseQuery:d&&d.parse?d.parse:function(o){var p=this._decode,r=o.split("&"),n=0,m=r.length,l={},q;for(;n<m;++n){q=r[n].split("=");if(q[0]){l[p(q[0])]=p(q[1]||"");}}return l;},_queue:function(){var m=arguments,l=this;h.push(function(){if(l._html5){if(b.UA.ios&&b.UA.ios<5){l._save.apply(l,m);}else{setTimeout(function(){l._save.apply(l,m);},1);}}else{l._dispatching=true;l._save.apply(l,m);}return l;});return !this._dispatching?this._dequeue():this;},_resolvePath:function(l){if(!l){return b.getLocation().pathname;}if(l.charAt(0)!=="/"){l=this._getPathRoot()+l;}return this._normalizePath(l);},_resolveURL:function(n){var r=n&&n.match(this._regexURL),m,q,o,p,l;if(!r){return b.getLocation().toString();}m=r[1];q=r[2];o=r[3];p=r[4];if(m){if(m.indexOf("//")===0){m=b.getLocation().protocol+m;}return m+(q||"/")+(o||"")+(p||"");}l=this._getOrigin()+this._resolvePath(q);if(q||o){return l+(o||"")+(p||"");}o=this._getQuery();return l+(o?("?"+o):"")+(p||"");},_save:function(n,o){var m=typeof n==="string",p,l;if(m&&!this._hasSameOrigin(n)){b.error("Security error: The new URL must be of the same origin as the current URL.");return this;}m&&(n=this._joinURL(n));this._ready=true;if(this._html5){this._history[o?"replace":"add"](null,{url:n});
}else{p=b.getLocation().pathname;l=this.get("root");if(l===p||l===this._getPathRoot()){n=this.removeRoot(n);}if(n===g.getHash()){b.Router.dispatch();}else{g[o?"replaceHash":"setHash"](n);}}return this;},_setRoutes:function(l){this._routes=[];i.each(l,function(m){var n=m.callbacks||m.callback;this.route(m.path,n);},this);return this._routes.concat();},_upgradeURL:function(m){if(!this._hasSameOrigin(m)){return m;}var o=(m.match(/#(.*)$/)||[])[1]||"",l=b.HistoryHash.hashPrefix,n;if(l&&o.indexOf(l)===0){o=o.replace(l,"");}o&&(n=this._getHashPath(o));if(n){return this._resolveURL(n);}return m;},_afterHistoryChange:function(n){var l=this,p=n.src,m=l._url,o=l._getURL();l._url=o;if(p==="popstate"&&(!l._ready||m.replace(/#.*$/,"")===o.replace(/#.*$/,""))){return;}l._dispatch(l._getPath(),o,p);},_defReadyFn:function(l){this._ready=true;}},{NAME:"router",ATTRS:{html5:{valueFn:function(){return b.Router.html5;},writeOnce:"initOnly"},root:{value:""},routes:{value:[],getter:"_getRoutes",setter:"_setRoutes"}},html5:b.HistoryBase.html5&&(!b.UA.android||b.UA.android>=3),_instances:a,dispatch:function(){var n,l,m;for(n=0,l=a.length;n<l;n+=1){m=a[n];if(m){m._dispatch(m._getPath(),m._getURL());}}}});b.Controller=b.Router;},"@VERSION@",{"optional":["querystring-parse"],"requires":["array-extras","base-build","history"]});