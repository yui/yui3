YUI.add("console-filters",function(c,f){var q=c.ClassNameManager.getClassName,h="console",b="filters",l="filter",g="category",d="source",e="category.",m="source.",p="host",r="checked",o="defaultVisibility",n=".",t="",s=n+c.Console.CHROME_CLASSES.console_bd_class,i=n+c.Console.CHROME_CLASSES.console_ft_class,a="input[type=checkbox].",j=c.Lang.isString;function k(){k.superclass.constructor.apply(this,arguments);}c.namespace("Plugin").ConsoleFilters=c.extend(k,c.Plugin.Base,{_entries:null,_cacheLimit:Number.POSITIVE_INFINITY,_categories:null,_sources:null,initializer:function(){this._entries=[];this.get(p).on("entry",this._onEntry,this);this.doAfter("renderUI",this.renderUI);this.doAfter("syncUI",this.syncUI);this.doAfter("bindUI",this.bindUI);this.doAfter("clearConsole",this._afterClearConsole);if(this.get(p).get("rendered")){this.renderUI();this.syncUI();this.bindUI();}this.after("cacheLimitChange",this._afterCacheLimitChange);},destructor:function(){this._entries=[];if(this._categories){this._categories.remove();}if(this._sources){this._sources.remove();}},renderUI:function(){var v=this.get(p).get("contentBox").one(i),u;if(v){u=c.Lang.sub(k.CATEGORIES_TEMPLATE,k.CHROME_CLASSES);this._categories=v.appendChild(c.Node.create(u));u=c.Lang.sub(k.SOURCES_TEMPLATE,k.CHROME_CLASSES);this._sources=v.appendChild(c.Node.create(u));}},bindUI:function(){this._categories.on("click",c.bind(this._onCategoryCheckboxClick,this));this._sources.on("click",c.bind(this._onSourceCheckboxClick,this));this.after("categoryChange",this._afterCategoryChange);this.after("sourceChange",this._afterSourceChange);},syncUI:function(){c.each(this.get(g),function(w,u){this._uiSetCheckbox(g,u,w);},this);c.each(this.get(d),function(w,u){this._uiSetCheckbox(d,u,w);},this);this.refreshConsole();},_onEntry:function(x){this._entries.push(x.message);var u=e+x.message.category,z=m+x.message.source,v=this.get(u),A=this.get(z),w=this._entries.length-this._cacheLimit,y;if(w>0){this._entries.splice(0,w);}if(v===undefined){y=this.get(o);this.set(u,y);v=y;}if(A===undefined){y=this.get(o);this.set(z,y);A=y;}if(!v||!A){x.preventDefault();}},_afterClearConsole:function(){this._entries=[];},_afterCategoryChange:function(w){var u=w.subAttrName.replace(/category\./,t),v=w.prevVal,x=w.newVal;if(!u||v[u]!==undefined){this.refreshConsole();this._filterBuffer();}if(u&&!w.fromUI){this._uiSetCheckbox(g,u,x[u]);}},_afterSourceChange:function(v){var x=v.subAttrName.replace(/source\./,t),u=v.prevVal,w=v.newVal;if(!x||u[x]!==undefined){this.refreshConsole();this._filterBuffer();}if(x&&!v.fromUI){this._uiSetCheckbox(d,x,w[x]);}},_filterBuffer:function(){var v=this.get(g),x=this.get(d),u=this.get(p).buffer,y=null,w;for(w=u.length-1;w>=0;--w){if(!v[u[w].category]||!x[u[w].source]){y=y||w;}else{if(y){u.splice(w,(y-w));y=null;}}}if(y){u.splice(0,y+1);}},_afterCacheLimitChange:function(u){if(isFinite(u.newVal)){var v=this._entries.length-u.newVal;if(v>0){this._entries.splice(0,v);}}},refreshConsole:function(){var y=this._entries,C=this.get(p),z=C.get("contentBox").one(s),v=C.get("consoleLimit"),B=this.get(g),u=this.get(d),w=[],x,A;if(z){C._cancelPrintLoop();for(x=y.length-1;x>=0&&v>=0;--x){A=y[x];if(B[A.category]&&u[A.source]){w.unshift(A);--v;}}z.setHTML(t);C.buffer=w;C.printBuffer();}},_uiSetCheckbox:function(v,y,x){if(v&&y){var u=v===g?this._categories:this._sources,A=a+q(h,l,y),z=u.one(A),w;if(!z){w=this.get(p);this._createCheckbox(u,y);z=u.one(A);w._uiSetHeight(w.get("height"));}z.set(r,x);}},_onCategoryCheckboxClick:function(w){var v=w.target,u;if(v.hasClass(k.CHROME_CLASSES.filter)){u=v.get("value");if(u&&u in this.get(g)){this.set(e+u,v.get(r),{fromUI:true});}}},_onSourceCheckboxClick:function(v){var u=v.target,w;if(u.hasClass(k.CHROME_CLASSES.filter)){w=u.get("value");if(w&&w in this.get(d)){this.set(m+w,u.get(r),{fromUI:true});}}},hideCategory:function(v,u){if(j(u)){c.Array.each(arguments,this.hideCategory,this);}else{this.set(e+v,false);}},showCategory:function(v,u){if(j(u)){c.Array.each(arguments,this.showCategory,this);}else{this.set(e+v,true);}},hideSource:function(v,u){if(j(u)){c.Array.each(arguments,this.hideSource,this);}else{this.set(m+v,false);}},showSource:function(v,u){if(j(u)){c.Array.each(arguments,this.showSource,this);}else{this.set(m+v,true);}},_createCheckbox:function(u,v){var x=c.merge(k.CHROME_CLASSES,{filter_name:v,filter_class:q(h,l,v)}),w=c.Node.create(c.Lang.sub(k.FILTER_TEMPLATE,x));u.appendChild(w);},_validateCategory:function(u,w){return c.Lang.isObject(w,true)&&u.split(/\./).length<3;},_validateSource:function(w,u){return c.Lang.isObject(u,true)&&w.split(/\./).length<3;},_setCacheLimit:function(u){if(c.Lang.isNumber(u)){this._cacheLimit=u;return u;}else{return c.Attribute.INVALID_VALUE;}}},{NAME:"consoleFilters",NS:l,CATEGORIES_TEMPLATE:'<div class="{categories}"></div>',SOURCES_TEMPLATE:'<div class="{sources}"></div>',FILTER_TEMPLATE:'<label class="{filter_label}">'+'<input type="checkbox" value="{filter_name}" '+'class="{filter} {filter_class}"> {filter_name}'+"</label>&#8201;",CHROME_CLASSES:{categories:q(h,b,"categories"),sources:q(h,b,"sources"),category:q(h,l,g),source:q(h,l,d),filter:q(h,l),filter_label:q(h,l,"label")},ATTRS:{defaultVisibility:{value:true,validator:c.Lang.isBoolean},category:{value:{},validator:function(w,u){return this._validateCategory(u,w);}},source:{value:{},validator:function(w,u){return this._validateSource(u,w);}},cacheLimit:{value:Number.POSITIVE_INFINITY,setter:function(u){return this._setCacheLimit(u);}}}});},"@VERSION@",{"requires":["plugin","console"],"skinnable":true});