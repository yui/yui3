YUI.add("ac-widget",function(A){function D(){D.superclass.constructor.apply(this,arguments);}var C="_handles",E="selectedIndex",J="_selectedIndex",G="_originalValue",B=A.Array.each,F="queryValue";A.ACWidget=A.extend(D,A.Widget,{initializer:function(){var K=this;K.after("queryChanged",K.syncUI,K);K.after("dataChanged",K.syncUI,K);K.hide();},renderUI:function(){var L=this.get("ac");if(!L){return;}var K=L.get("host");H(this.get("boundingBox"),K);return this.setSize();},setSize:function(){return this.set("width",this.get("ac").get("host").getComputedStyle("width"));},bindUI:function(L){var M=this,K=M.get("contentBox"),L=L||M.get("ac");if(M[C]){B(M[C],function(N){N.detach();});M[C]=0;}if(L){M[C]=[K.delegate("click",M.click,"li",M),A.on("click",M.hide,document),L.on("ac:load",function(N){M.set("query",N.query).set("data",N.results).syncUI().show();}),L.on("ac:query",function(N){M.set("query",N.value).syncUI();}),L.on("ac:next",M.next,M),L.on("ac:previous",M.previous,M),L.on("ac:hide",M.hide,M)];}return M;},syncUI:function(){var K=this,M=K.get("data"),L=K.get("query");if(!M){return K;}K[J]=-1;K[G]="";K.get("contentBox").set("innerHTML",K.getListMarkup(M));return K;},getListMarkup:function(N){var M=this,K=M.get("listTpl"),L=[];B(N,function(O){L.push(M.getItemMarkup(O));});return K.replace(/\{list\}/g,L.join(""));},getItemMarkup:function(K){return this.get("itemTpl").replace(/\{term\}/g,K).replace(/\{hilite\}/g,this.getHiliteMarkup(K));},getHiliteMarkup:function(M){var L=this,K=L.get("query").split(/\s+/);out=M;B(K,function(N){if(!N){return;}N=I(N);out=out.replace(new RegExp(N,"g"),L.get("hiliteTpl").replace(/\{term\}/g,N));});return out;},next:function(){var K=this;if(K.get("visible")){return K.selectNext();}if(K.get("data")){K.show();}return K;},selectNext:function(){var K=this.get(E);return this.set(E,K+1);},selectPrevious:function(){var K=this.get(E);return this.set(E,K-1);},previous:function(){if(this.get("visible")){this.selectPrevious();}return this;},item:function(K){return this.get("contentBox").one(this.get("itemSelector").replace(/\{n\}/g,I(K+1)));},click:function(M){var K=this,L=K.get("ac"),N=M.currentTarget.get("text");L.set(F,N);K[J]=-1;K._currentValue=N;L.get("host").focus();K.hide();}},{NAME:"ACWidget",ATTRS:{ac:{setter:function(K){if(!this[C]){return;}this.bindUI(K);},validator:function(K){return true;}},data:{validator:function(K){return K&&K.length>0;}},query:{value:""},listTpl:{value:"<ul>{list}</ul>"},itemTpl:{value:"<li>{hilite}</li>"},itemSelector:{value:"ul li:nth-child({n})"},hiliteTpl:{value:"<em>{term}</em>"}}});D.ATTRS[E]={value:-1,validator:function(K){var L=this.get("data");return L&&A.Lang.isNumber(K);},getter:function(){return this[J];},setter:function(M){var R=this,O=R.get(E),P=R.get("data"),K=P&&P.length,Q=R.get("ac"),L=this.getClassName("selected");if(isNaN(O)){O=-1;}if(!P||!K){return;}while(M<-1){M+=K+1;}M=(M+1)%(K+1)-1;O=(O+1)%(K+1)-1;R[J]=M;if(O===-1){R[G]=Q.get(F);}if(O===M){return;}var S=R.get("contentBox").one("."+L);if(S){S.removeClass(L);}if(M===-1){Q.set(F,this[G]);}else{var N=R.item(M);if(N){N.addClass(L);}Q.set(F,P[M]);}return M;}};function I(K){return(""+K).replace(/([\/\.\*\+\?\|\(\)\[\]\{\}\\])/g,"\\$1");}function H(L,K){var M=K.get("parentNode");M.insertBefore(L,K);M.insertBefore(K,L);}},"@VERSION@",{requires:["widget","ac-plugin"]});