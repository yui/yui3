YUI.add("model-list",function(h){var f=h.Attribute.prototype,e=h.Lang,d=h.Array,c="add",g="refresh",a="remove";function b(){b.superclass.constructor.apply(this,arguments);}h.ModelList=h.extend(b,h.Base,{model:null,initializer:function(j){j||(j={});var i=this.model=j.model||this.model;this.publish(c,{defaultFn:this._defAddFn});this.publish(g,{defaultFn:this._defRefreshFn});this.publish(a,{defaultFn:this._defRemoveFn});if(i){this.after("*:idChange",this._afterIdChange);}else{}this._clear();},destructor:function(){d.each(this._items,this._detachList,this);},add:function(j,i){if(e.isArray(j)){return d.map(j,function(k){return this._add(k,i);},this);}else{return this._add(j,i);}},create:function(k,j,l){var i=this;if(typeof j==="function"){l=j;j={};}if(!(k instanceof h.Model)){k=new this.model(k);}return k.save(j,function(m){if(!m){i.add(k,j);}l&&l.apply(null,arguments);});},get:function(i){if(this.attrAdded(i)){return f.get.apply(this,arguments);}return this.invoke("get",i);},getAsHTML:function(i){if(this.attrAdded(i)){return h.Escape.html(f.get.apply(this,arguments));}return this.invoke("getAsHTML",i);},getAsURL:function(i){if(this.attrAdded(i)){return encodeURIComponent(f.get.apply(this,arguments));}return this.invoke("getAsURL",i);},getByClientId:function(i){return this._clientIdMap[i]||null;},getById:function(i){return this._idMap[i]||null;},invoke:function(j){var i=[this._items,j].concat(d(arguments,1,true));return d.invoke.apply(d,i);},load:function(j,k){var i=this;if(typeof j==="function"){k=j;j={};}this.sync("read",j,function(m,l){if(!m){i.refresh(i.parse(l),j);}k&&k.apply(null,arguments);});return this;},map:function(i,j){return d.map(this._items,i,j);},parse:function(i){if(typeof i==="string"){try{return h.JSON.parse(i)||[];}catch(j){h.error("Failed to parse JSON response.");return null;}}return i||[];},refresh:function(k,i){i||(i={});var j=h.merge(i,{src:"refresh",models:d.map(k,function(l){return l instanceof h.Model?l:new this.model(l);},this)});if(this.comparator){j.models.sort(h.bind(this._sort,this));}i.silent?this._defRefreshFn(j):this.fire(g,j);return this;},remove:function(j,i){if(e.isArray(j)){return d.map(j,function(k){return this._remove(k,i);},this);}else{return this._remove(j,i);}},sort:function(i){var k=this._items.concat(),j;if(!this.comparator){return this;}i||(i={});k.sort(h.bind(this._sort,this));j=h.merge(i,{models:k,src:"sort"});i.silent?this._defRefreshFn(j):this.fire(g,j);return this;},sync:function(){var i=d(arguments,0,true).pop();if(typeof i==="function"){i();}},toArray:function(){return this._items.concat();},toJSON:function(){return this.map(function(i){return i.toJSON();});},_add:function(j,i){var k;i||(i={});if(!(j instanceof h.Model)){j=new this.model(j);}if(this._clientIdMap[j.get("clientId")]){h.error("Model already in list.");return;}k=h.merge(i,{index:this._findIndex(j),model:j});i.silent?this._defAddFn(k):this.fire(c,k);return j;},_attachList:function(i){i.lists.push(this);i.addTarget(this);},_clear:function(){d.each(this._items,this._detachList,this);this._clientIdMap={};this._idMap={};this._items=[];},_detachList:function(j){var i=d.indexOf(j.lists,this);if(i>-1){j.lists.splice(i,1);j.removeTarget(this);}},_findIndex:function(m){var j=this.comparator,k=this._items,i=k.length,n=0,o,l,p;if(!j||!k.length){return k.length;}p=j(m);while(n<i){l=(n+i)>>1;o=k[l];if(j(o)<p){n=l+1;}else{i=l;}}return n;},_remove:function(k,j){var i=this.indexOf(k),l;j||(j={});if(i===-1){h.error("Model not in list.");return;}l=h.merge(j,{index:i,model:k});j.silent?this._defRemoveFn(l):this.fire(a,l);return k;},_sort:function(j,i){var l=this.comparator(j),k=this.comparator(i);return l<k?-1:(l>k?1:0);},_afterIdChange:function(i){i.prevVal&&delete this._idMap[i.prevVal];i.newVal&&(this._idMap[i.newVal]=i.target);},_defAddFn:function(j){var i=j.model,k=i.get("id");this._clientIdMap[i.get("clientId")]=i;if(k){this._idMap[k]=i;}this._attachList(i);this._items.splice(j.index,0,i);},_defRefreshFn:function(i){if(i.src==="sort"){this._items=i.models.concat();return;}this._clear();if(i.models.length){this.add(i.models,{silent:true});}},_defRemoveFn:function(j){var i=j.model,k=i.get("id");this._detachList(i);delete this._clientIdMap[i.get("clientId")];if(k){delete this._idMap[k];}this._items.splice(j.index,1);}},{NAME:"modelList"});h.augment(b,h.ArrayList);},"@VERSION@",{requires:["array-extras","array-invoke","arraylist","base-build","escape","json-parse","model"]});