YUI.add("dd-ddm-drop",function(b,a){b.mix(b.DD.DDM,{_noShim:false,_activeShims:[],_hasActiveShim:function(){if(this._noShim){return true;}return this._activeShims.length;},_addActiveShim:function(c){this._activeShims[this._activeShims.length]=c;},_removeActiveShim:function(e){var c=[];b.each(this._activeShims,function(f,d){if(f._yuid!==e._yuid){c[c.length]=f;}});this._activeShims=c;},syncActiveShims:function(c){b.later(0,this,function(d){var e=((d)?this.targets:this._lookup());b.each(e,function(g,f){g.sizeShim.call(g);},this);},c);},mode:0,POINT:0,INTERSECT:1,STRICT:2,useHash:true,activeDrop:null,validDrops:[],otherDrops:{},targets:[],_addValid:function(c){this.validDrops[this.validDrops.length]=c;return this;},_removeValid:function(c){var d=[];b.each(this.validDrops,function(f,e){if(f!==c){d[d.length]=f;}});this.validDrops=d;return this;},isOverTarget:function(d){if(this.activeDrag&&d){var h=this.activeDrag.mouseXY,g,c=this.activeDrag.get("dragMode"),f,e=d.shim;if(h&&this.activeDrag){f=this.activeDrag.region;if(c==this.STRICT){return this.activeDrag.get("dragNode").inRegion(d.region,true,f);}if(d&&d.shim){if((c==this.INTERSECT)&&this._noShim){g=f||this.activeDrag.get("node");return d.get("node").intersect(g,d.region).inRegion;}if(this._noShim){e=d.get("node");}return e.intersect({top:h[1],bottom:h[1],left:h[0],right:h[0]},d.region).inRegion;}}}return false;},clearCache:function(){this.validDrops=[];this.otherDrops={};this._activeShims=[];},_activateTargets:function(){this._noShim=true;this.clearCache();b.each(this.targets,function(d,c){d._activateShim([]);if(d.get("noShim")==true){this._noShim=false;}},this);this._handleTargetOver();},getBestMatch:function(g,e){var d=null,f=0,c;b.each(g,function(j,i){var h=this.activeDrag.get("dragNode").intersect(j.get("node"));j.region.area=h.area;if(h.inRegion){if(h.area>f){f=h.area;d=j;}}},this);if(e){c=[];b.each(g,function(i,h){if(i!==d){c[c.length]=i;}},this);return[d,c];}return d;},_deactivateTargets:function(){var c=[],d,f=this.activeDrag,e=this.activeDrop;if(f&&e&&this.otherDrops[e]){if(!f.get("dragMode")){c=this.otherDrops;delete c[e];}else{d=this.getBestMatch(this.otherDrops,true);e=d[0];c=d[1];}f.get("node").removeClass(this.CSS_PREFIX+"-drag-over");if(e){e.fire("drop:hit",{drag:f,drop:e,others:c});f.fire("drag:drophit",{drag:f,drop:e,others:c});}}else{if(f&&f.get("dragging")){f.get("node").removeClass(this.CSS_PREFIX+"-drag-over");f.fire("drag:dropmiss",{pageX:f.lastXY[0],pageY:f.lastXY[1]});}}this.activeDrop=null;b.each(this.targets,function(h,g){h._deactivateShim([]);},this);},_dropMove:function(){if(this._hasActiveShim()){this._handleTargetOver();}else{b.each(this.otherDrops,function(d,c){d._handleOut.apply(d,[]);});}},_lookup:function(){if(!this.useHash||this._noShim){return this.validDrops;}var c=[];b.each(this.validDrops,function(e,d){if(e.shim&&e.shim.inViewportRegion(false,e.region)){c[c.length]=e;}});return c;},_handleTargetOver:function(){var c=this._lookup();b.each(c,function(e,d){e._handleTargetOver.call(e);},this);},_regTarget:function(c){this.targets[this.targets.length]=c;},_unregTarget:function(d){var c=[],e;b.each(this.targets,function(g,f){if(g!=d){c[c.length]=g;}},this);this.targets=c;e=[];b.each(this.validDrops,function(g,f){if(g!==d){e[e.length]=g;}});this.validDrops=e;},getDrop:function(d){var c=false,e=b.one(d);if(e instanceof b.Node){b.each(this.targets,function(g,f){if(e.compareTo(g.get("node"))){c=g;}});}return c;}},true);},"@VERSION@",{"requires":["dd-ddm"]});