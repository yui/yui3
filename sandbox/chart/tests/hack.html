<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Y! Finance</title>
    <meta name="author" content="Allen Rabinovich">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
<style>
#custom-doc { width: 95%; min-width: 950px; }
#pagetitle {background-image: url(../../assets/bg_hd.gif);}
    html, body {
		width:100%;
		height:100%;
        /*overflow:hidden;*/
        margin:0;
		background-color:#000;
    }
	#charts-app {
		width:100%;
		height:100%;
	}
	#left-column {
		width:80%;
		height:100%;
		float:left;
		background-color:#ccc;
		text-align:center;
	}
	
	#right-column {
		width:20%;
		height:100%;
		display:block;
		float:left;
		background-color:#ddd;
		text-align:center;
		background-image:url('http://www.mysteryhunt.ws/ipadcharts/rightback.png');
		background-repeat:repeat-y;
	}
	
	#stock-info {
		position:relative;
		width:100%;
		height:15%;
		display:block;
		background-image:url('http://www.mysteryhunt.ws/ipadcharts/top-bck.png');
		background-repeat:repeat-x;
		padding:auto;
	}
	
	#big-chart {
		width:100%;
		height:70%;
		display:block;
		background-color:#ccc;
		background-image:url('http://www.mysteryhunt.ws/ipadcharts/paperback.jpg');
		background-repeat:no-repeat;
	}
	
	#small-chart {
		position:relative;
		width:100%;
		height:15%;
		background-color:#f00;
		background-image:url('http://www.mysteryhunt.ws/ipadcharts/bottomback.png');
		background-repeat:repeat-x;
	}
	
	#search-box {
		width:100%;
		height:10%;
		display:block;
		background-image:url('http://www.mysteryhunt.ws/ipadcharts/rightback.png');
		background-repeat:repeat-y;
	}
	
	#search-results {
		width:100%;
		height:90%;
		display:block;
		text-align:center;
		background-image:url('http://www.mysteryhunt.ws/ipadcharts/rightback.png');
		background-repeat:repeat-y;
	}
	
	#slider {
		position:absolute;
		left:50%;
        z-index:5;
		margin-left:-10px;
		width:40px;
		min-width:40px;
		height:100%;
		background-color:rgba(255,255,255,0.3);
		max-width:100%;
	}
	
	.sidestocksel {
		-webkit-border-radius:10px;
		background-image:url('http://www.mysteryhunt.ws/ipadcharts/bottomback.png');
		background-repeat:repeat-x;
		width:90%;
		height:6%;
		font-family:Georgia;
		font-size:25px;
		color:#fff;
		text-align:center;
		margin-left:10px;
		margin-top:10px;
	}
	
	
	.sidestock {
		-webkit-border-radius:10px;
		background-image:url('http://www.mysteryhunt.ws/ipadcharts/top-bck.png');
		background-repeat:repeat-x;
		width:90%;
		height:6%;
		font-family:Georgia;
		font-size:25px;
		color:#fff;
		text-align:center;
		margin-left:10px;
		margin-top:10px;
	}
	
	.ticker {
		text-align:center; 
		display:inline-block; 
		margin:20px 0 0 20px;
	}
</style>
<!-- BEGIN EXAMPLE CODE -->
	<script type="text/javascript" src="http://yui.yahooapis.com/3.1.1/build/yui/yui.js"></script>
    <script type="text/javascript" src="../../graphics/build/graphics/graphics.js"></script>
    <script type="text/javascript" src="../build/infographics/infographics.js"></script>
		
</head>		
<body class="yui3-skin-sam">
		
	<script>	
		var starttime;
		var mydate = new Date();
		starttime = mydate.valueOf();
		var randValue = Math.random()*401;
		var randValue2 = Math.random()*401;
		function writeToDiv(message)
		{
			var mydate = new Date();
			var diff = mydate.valueOf() - starttime;
			message += ": " + diff;
			document.getElementById("search-box").innerHTML += "<br/>" + message;
		}
			var getData = function()
			{
				var bigArray = new Array();
				var tempObj = new Object();
				var i = (Math.floor(Math.random()*12)) + 1;
				var end = i + 23;
				var month;
				var year;
				var expensesValue = 8000;
				for(i;i <= end; i++)
				{
					month = i;
					year = 2009;
					expensesValue = Math.floor(expensesValue * .9);
					if(i > 24)
					{
						month = i -24;
						year +=2;
					}
					else if(i > 12)
					{
						month = i - 12;
						year +=1;
					}
					bigArray  = bigArray.concat(getMonthOfDates(month, getNumberOfDays(month, year), year, expensesValue))
				}
				return bigArray;
			}

			function getNumberOfDays(mon, year)
			{
				if(mon == 4 || mon == 6 || mon == 9 || mon ==11)
				{
					return 30;
				}
				if(mon == 2)
				{
					return year%4==0?29:28;
				}
				return 31;
			}

			function getMonthOfDates(mon, max, year, value)
			{

				var month = new Array();
				dValue = value;
				
				for(var i = 1; i <= max; i++)
				{
					var obj = new Object();
					obj.date = mon + "/" + i + "/" + year;
				//	var div = ((Math.random()*5))
				//	var cont = (Math.random() * 101) * div;
					randValue = randValue + (-30 + Math.random()*60);
					randValue2 = randValue2 + (-30 + Math.random()*60);
					obj.revenue = (randValue);
					dValue = dValue - 1;
					obj.expenses = (randValue2);
					month[month.length] = obj;

				}
				return month;
			}
		</script>
<div id="charts-app">
	<div id="left-column">
<div id="stock-info">
			<div id="logo" style="position:absolute;top:50%;left:10px;margin-top:-19px;">	
				<img src="http://www.mysteryhunt.ws/ipadcharts/yahoologo.png" />
			</div>	
			<div id="stockstuff" style="margin-left:250px;">

				<div class="ticker">
					<span id="ticker" style="display:block;color:#38991D;font-size:35px;font-family:'Georgia';">YHOO</span>
					<span id="company-name" style="display:block;color:#fff;font-size:10px;font-family:'Helvetica Neue', Helvetica, Arial;">Yahoo! Inc.</span>
				</div>
				<div class="ticker">
					<span id="open" style="position:relative;top:-5px;display:block;color:#38991D;font-size:35px;font-family:'Georgia';">15.77</span>
					<span id="textopen" style="display:block;color:#fff;font-size:10px;font-family:'Helvetica Neue', Helvetica, Arial;">open</span>

				</div>
				<div class="ticker">
					<span id="high" style="position:relative;top:-5px;display:block;color:#38991D;font-size:35px;font-family:'Georgia';">15.95</span>
					<span id="texthigh" style="display:block;color:#fff;font-size:10px;font-family:'Helvetica Neue', Helvetica, Arial;">high</span>
				</div>
				<div class="ticker">
					<span id="low" style="position:relative;top:-5px;display:block;color:#38991D;font-size:35px;font-family:'Georgia';">15.31</span>

					<span id="textlow" style="display:block;color:#fff;font-size:10px;font-family:'Helvetica Neue', Helvetica, Arial;">low</span>
				</div>
			</div>

		</div>
        <div id="chart"></div>
		<div id="big-chart"></div>
		<div id="small-chart"><div id="slider"></div></div>	
</div>
	<div id="right-column">
		<div id="search-box">
			<input type="text" size="15" style="font-size:20px;border-style:solid;height:12px;-webkit-border-radius:10px;margin-top:10px;"/>
		</div>
		<div id="search-results">
		<div id="stock1" class="sidestocksel"><div style="position:relative;top:3px;">YHOO</div></div>
		<div id="stock2" class="sidestock"><div style="position:relative;top:3px;">AAPL</div></div>
		<div id="stock3" class="sidestock"><div style="position:relative;top:3px;">MSFT</div></div>

		<div id="stock3" class="sidestock"><div style="position:relative;top:3px;">ADBE</div></div>
		</div>
	</div>
		<script>

			YUI().use('node', 'json', 'dd-constrain', 'event-custom', 'base', 'slider', 'graphics', 'infographics', function (Y)
            {
                var TOUCH = Y.UA.webkit && Y.UA.mobile, 
                    EVT_MAP;

                if (TOUCH) {
                    // Node Hack - Add touch event support
                    Y.mix(Y.Node.DOM_EVENTS, { gesturechange:1, touchstart:1, touchmove:1, touchend:1} );

                    // Event Hack - Add custom properties to event facade
                    Y._DOMEventFacade = Y.DOMEventFacade;
                    Y.DOMEventFacade = function(ev, currentTarget, wrapper) {
                        var e = new Y._DOMEventFacade(ev, currentTarget, wrapper);
                        if (ev.touches) {
                            e.touches = [];
                            if (ev.touches[0]) {
                                e.touches[0] = new Y.DOMEventFacade(ev.touches[0], currentTarget, wrapper);
                            }
                            if (ev.touches[1]) {
                                e.touches[1] = new Y.DOMEventFacade(ev.touches[1], currentTarget, wrapper);
                            }
                        }
                        e.scale = ev.scale;
                        return e;
                    };
                }

                var smallChart = Y.one("#small-chart");
                var smallChartText = Y.one("#small-chart-text");
                var slider = Y.one("#slider");
                var sliderWidth = 40;
                Y.one("body").on("touchmove", function(event) {
                    event.preventDefault();
                });

                smallChart.on("gesturechange", function(event) {

                    var scale = event.scale;
                    var width = slider.get("offsetWidth");

                    if (scale < 1) {
                        slider.setStyle("width", (width - 5/Math.pow(scale,2)) + "px");
                    } else {
                        slider.setStyle("width", (width + 5*Math.pow(scale,2)) + "px");
                    }
                    slider.setStyle("marginLeft", "-" + slider.get("offsetWidth")/2 + "px");
                        var minVal = slider.get("region").left;
                        var maxVal = minVal + width;
                        var len = document.getElementById("small-chart").offsetWidth;
                        sliderWidth = width;
                        timeaxis.updateMinByPosition(minVal, len);
                        timeaxis.updateMaxByPosition(maxVal, len);
                });

                var dd = new Y.DD.Drag({
                    useShim:false,
                    node: slider,
                    clickPixelThresh:1,
                    clickTimeThresh:100
                }).plug(Y.Plugin.DDConstrained, {
                    constrain2node: smallChart
                });

                if (TOUCH) {
                    // DD Hack - Use mouse move to kick of move programmatically
                    dd.get('node').on('touchmove', function(event) {
                        if(event.touches.length == 1) {
                           if (!dd.get('dragging')) {
                               dd.fire('drag:mouseDown', { ev: event.touches[0] });
                               dd._ev_md = event.touches[0];
                           } else {
                               Y.DD.DDM._move.apply(Y.DD.DDM, [event.touches[0]]);
                           }
                           event.preventDefault();
                        }
                    });
                }
					// Create data 
					var mydata = getData();

					
					var expensegraphstyles = {
						color:"#5577AF",
						marker:{func:"drawCircle", fillColor:"#5577AF", width:6, height:6},
						weight:"2",
                        showLines:true,
						showMarkers:true
					};

					// Add revenue graph styles
					var revenuegraphstyles = {
						color:"#5577AF",
						marker:{func:"drawCircle", fillColor:"#5577AF", width:6, height:6},
						weight:"2",
                        showLines:true,
						showMarkers:true
					};
                    var dataProvider = {data:mydata};
                    var dp2 = {data:mydata.concat()};
                    var timeaxis = new Y.TimeAxis({dataProvider:dataProvider});
					timeaxis.addKey("date");
					timeaxis.set("autoMax", false);
                    timeaxis.set("autoMin", false);
                    
                    var slidertimeaxis = new Y.TimeAxis({dataProvider:dataProvider});
					slidertimeaxis.addKey("date");
                    var numericaxis = new Y.NumericAxis({dataProvider:dataProvider});
					numericaxis.addKey("revenue");
					
                    //var linegraph = new Y.LineSeries({parent:"big-chart", xAxis:timeaxis, yAxis:numericaxis, xKey:"date", yKey:"revenue", styles:expensegraphstyles});
				
                   
                    var linegraph = new Y.GraphStack({parent:"big-chart", seriesCollection:[{
                                                                                            type:"line", 
                                                                                            xAxis:timeaxis, 
                                                                                            yAxis:numericaxis, 
                                                                                            xKey:"date", 
                                                                                            yKey:"revenue", 
                                                                                            styles:revenuegraphstyles
                                                                                        }
                                                                                        ]});
                    //var slidergraph = new Y.LineSeries({parent:"small-chart", xAxis:slidertimeaxis, yAxis:numericaxis, xKey:"date", yKey:"revenue", styles:expensegraphstyles});
                    var slidergraph = new Y.GraphStack({parent:"small-chart", seriesCollection:[{
                                                                                            type:"line", 
                                                                                            xAxis:slidertimeaxis, 
                                                                                            yAxis:numericaxis, 
                                                                                            xKey:"date", 
                                                                                            yKey:"revenue", 
                                                                                            styles:revenuegraphstyles
                                                                                        }
                                                                                        ]});
                    function calculateAndUpdateMin(e)
                    {
                        var target = e.currentTarget,
                            val = target.get("value"),
                            len = parseInt(target.get("length"), 10),
                            pos = val/len;
                        timeaxis.updateMinByPosition(pos);
                    }

                    function calculateAndUpdateMax(e)
                    {
                        var target = e.currentTarget,
                            val = target.get("value"),
                            len = parseInt(target.get("length"), 10),
                            pos = val/len;
                        timeaxis.updateMaxByPosition(pos);
                    }
                   
                    function calculateAndUpdateMinAndMax(e)
                    {
                        var target = e.currentTarget,
                            minVal = target.get("node").get("region").left,
                            maxVal = minVal + sliderWidth, 
                            len = document.getElementById("small-chart").offsetWidth,
                            minPos = minVal/len,
                            maxPos = maxVal/len;
                        try
                        {
                        timeaxis.updateMinByPosition(minPos);
                        timeaxis.updateMaxByPosition(maxPos);
                        }
                        catch(e)
                        {
                        //    alert(len + ", " + (Math.round(minPos*100)/100) + ", " + (Math.round(maxPos*100)/100));
                        }
                    }
                   
                    dd.on("drag", Y.bind(calculateAndUpdateMinAndMax, this)); 
                    
                });
</script>
<!-- END EXAMPLE CODE -->
</div>
</body>
</html>
