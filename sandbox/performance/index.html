<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>YUI Performance Tool</title>
    <link rel="stylesheet" href="assets/performance.css">
</head>
<body>

<h1>YUI Performance Tool</h1>

<p>
    <select id="suites"></select>
    <button id="start">Start Tests</button>
    <button id="stop" disabled="disabled">Stop Tests</button>
    <button id="snap" disabled="disabled">Result Snapshot (JSON)</button>
</p>

<div id="results"></div>

<p class="firefox hidden">
    <strong>Firefox users:</strong> For accurate results, disable Firebug.
</p>

<p class="ie hidden">
    <strong>IE users:</strong> Due to limitations in the resolution of the
    Windows timer APIs that IE uses, times in IE have an error range of Â±15ms.
</p>

<div id="snapshot" class="hidden">
    <h2><label for="result-snapshot">Result Snapshot</label></h2>
    <textarea id="result-snapshot" cols="5" rows="50"></textarea>
</div>

<script src="../../build/yui/yui-min.js"></script>
<script src="js/sandbox.js"></script>
<script src="js/performance.js"></script>
<script src="tests/perf-component.js"></script>
<script src="tests/perf-instantiation.js"></script>
<script src="tests/perf-loops-native.js"></script>
<script src="tests/perf-loops-yui3.js"></script>
<script>
var Y = YUI().use('event-base', 'history', 'json-stringify', 'node-base',
    'performance', 'perf-component', 'perf-instantiation', 'perf-loops-native',
    'perf-loops-yui3', function (Y) {

    var Perf    = Y.Performance,
        history = new Y.History(),

        snap    = Y.one('#snap'),
        start   = Y.one('#start'),
        stop    = Y.one('#stop'),
        suites  = Y.one('#suites');

    if (Y.UA.gecko) {
        Y.all('.firefox').removeClass('hidden');
    } else if (Y.UA.ie) {
        Y.all('.ie').removeClass('hidden');
    }

    // Populate the test list.
    Y.Object.each(Perf.getTestSuites(), function (suite, name) {
        suites.append(Y.Node.create('<option/>').append(name));
    });

    // Set the selected suite to the one specified in the URL, if any.
    suites.set('value', history.get('suite'));

    // Render the result table.
    Perf.render('#results');

    // Handle history changes.
    history.on('suiteChange', function (e) {
        Perf.stop();

        if (e.src === Y.History.SRC_HASH) {
            suites.set('value', e.newVal);
        }
    });

    history.on('suiteRemove', function (e) {
        Perf.stop();

        if (e.src === Y.History.SRC_HASH) {
            suites.set('selectedIndex', 0);
        }
    });

    // Handle module selection changes.
    suites.on('change', function () {
        history.add('suite', this.get('value') || null);
    });

    // Handle Start clicks.
    start.on('click', function () {
        Perf.start(suites.get('value'));
    });

    // Handle Stop clicks.
    stop.on('click', function () {
        Perf.stop();
    });

    // Handle snapshot clicks.
    snap.on('click', function () {
        Y.one('#result-snapshot').set('value', Y.JSON.stringify(Perf._results, null, 2));
        Y.one('#snapshot').toggleClass('hidden');
    });

    // Handle test start.
    Perf.on('start', function () {
        Y.all([snap, start]).set('disabled', true);
        stop.set('disabled', false);
        Y.one('#snapshot').addClass('hidden');
    });

    // Handle test stop/finish.
    Perf.on('finish', function () {
        Y.all([snap, start]).set('disabled', false);
        stop.set('disabled', true);
    });
});
</script>

</body>
</html>
