<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns:yui="http://yuilibrary.com/rdf/1.0/yui.rdf#">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<title>API: node-focusmanager   node-focusmanager.js  (YUI Library)</title>

	<link rel="stylesheet" type="text/css" href="assets/reset-fonts-grids-min.css" />
	<link rel="stylesheet" type="text/css" href="assets/api.css" />

    <script type="text/javascript" src="assets/api-js"></script>
    <script type="text/javascript" src="assets/ac-js"></script>
</head>

<body id="yahoo-com">

<div id="doc3" class="yui-t2">
	<div id="hd">
        <h1><a href="http://developer.yahoo.com/yui/" title="Yahoo! UI Library">Yahoo! UI Library</a></h1>
        <h3>node-focusmanager&nbsp; <span class="subtitle">3.0.0</span></h3>
        <a href="./index.html" title="Yahoo! UI Library">Yahoo! UI Library</a> 
            &gt; <a href="./module_node-focusmanager.html" title="node-focusmanager">node-focusmanager</a>
                
                 &gt; node-focusmanager.js (source view) 
        <form onsubmit="return false">
            <div id="propertysearch">
                Search: <input autocomplete="off" id="searchinput" />
                <div id="searchresults">
                    &nbsp;
                </div>
            </div>
        </form>
	</div>

	<div id="bd">
		<div id="yui-main">
			<div class="yui-b">
            <form action="#" name="yui-classopts-form" method="get" id="yui-classopts-form">
                <fieldset>
                    <legend>Filters</legend>
                <span class="classopts"><input type="checkbox" name="show_private" id="show_private" /> <label for="show_private">Show Private</label></span>
                <span class="classopts"><input type="checkbox" name="show_protected" id="show_protected" /> <label for="show_protected">Show Protected</label></span>
                <span class="classopts"><input type="checkbox" name="show_deprecated" id="show_deprecated" /> <label for="show_deprecated">Show Deprecated</label></span>
                </fieldset>
            </form>

                    <div id="srcout">
                        <style>
                            #doc3 .classopts { display:none; }
                        </style>
                        <div class="highlight" ><pre><span class="c">/**</span>
<span class="c">* &lt;p&gt;The Focus Manager Node Plugin makes it easy to manage focus among  </span>
<span class="c">* a Node&#39;s descendants.  Primarily intended to help with widget development, </span>
<span class="c">* the Focus Manager Node Plugin can be used to improve the keyboard </span>
<span class="c">* accessibility of widgets.&lt;/p&gt;</span>
<span class="c">* </span>
<span class="c">* &lt;p&gt;</span>
<span class="c">* When designing widgets that manage a set of descendant controls (i.e. buttons</span>
<span class="c">* in a toolbar, tabs in a tablist, menuitems in a menu, etc.) it is important to </span>
<span class="c">* limit the number of descendants in the browser&#39;s default tab flow.  The fewer </span>
<span class="c">* number of descendants in the default tab flow, the easier it is for keyboard </span>
<span class="c">* users to navigate between widgets by pressing the tab key.  When a widget has </span>
<span class="c">* focus it should provide a set of shortcut keys (typically the arrow keys) </span>
<span class="c">* to move focus among its descendants.</span>
<span class="c">* &lt;/p&gt;</span>
<span class="c">* </span>
<span class="c">* &lt;p&gt;</span>
<span class="c">* To this end, the Focus Manager Node Plugin makes it easy to define a Node&#39;s </span>
<span class="c">* focusable descendants, define which descendant should be in the default tab </span>
<span class="c">* flow, and define the keys that move focus among each descendant.</span>
<span class="c">* Additionally, as the CSS </span>
<span class="c">* &lt;a href=&quot;http://www.w3.org/TR/CSS21/selector.html#x38&quot;&gt;&lt;code&gt;:focus&lt;/code&gt;&lt;/a&gt; </span>
<span class="c">* pseudo class is not supported on all elements in all </span>
<span class="c">* &lt;a href=&quot;http://developer.yahoo.com/yui/articles/gbs/&quot;&gt;A-Grade browsers&lt;/a&gt;,</span>
<span class="c">* the Focus Manager Node Plugin provides an easy, cross-browser means of </span>
<span class="c">* styling focus.</span>
<span class="c">* &lt;/p&gt;</span>
<span class="c">*  </span>
<span class="c">* @module node-focusmanager</span>
<span class="c">*/</span>

	<span class="c">//	Frequently used strings</span>
<span class="c"></span>
<span class="k">var</span> <span class="nx">ACTIVE_DESCENDANT</span> <span class="o">=</span> <span class="s2">&quot;activeDescendant&quot;</span><span class="o">,</span>
	<span class="nx">ID</span> <span class="o">=</span> <span class="s2">&quot;id&quot;</span><span class="o">,</span>
	<span class="nx">DISABLED</span> <span class="o">=</span> <span class="s2">&quot;disabled&quot;</span><span class="o">,</span>
	<span class="nx">TAB_INDEX</span> <span class="o">=</span> <span class="s2">&quot;tabIndex&quot;</span><span class="o">,</span>
	<span class="nx">FOCUSED</span> <span class="o">=</span> <span class="s2">&quot;focused&quot;</span><span class="o">,</span>
	<span class="nx">FOCUS_CLASS</span> <span class="o">=</span> <span class="s2">&quot;focusClass&quot;</span><span class="o">,</span>
	<span class="nx">CIRCULAR</span> <span class="o">=</span> <span class="s2">&quot;circular&quot;</span><span class="o">,</span>
	<span class="nx">UI</span> <span class="o">=</span> <span class="s2">&quot;UI&quot;</span><span class="o">,</span>
	<span class="nx">KEY</span> <span class="o">=</span> <span class="s2">&quot;key&quot;</span><span class="o">,</span>
	<span class="nx">ACTIVE_DESCENDANT_CHANGE</span> <span class="o">=</span> <span class="nx">ACTIVE_DESCENDANT</span> <span class="o">+</span> <span class="s2">&quot;Change&quot;</span><span class="o">,</span>
	<span class="nx">HOST</span> <span class="o">=</span> <span class="s2">&quot;host&quot;</span><span class="o">,</span>

	<span class="c">//	Collection of keys that, when pressed, cause the browser viewport</span>
<span class="c"></span>	<span class="c">//	to scroll.</span>
<span class="c"></span>	<span class="nx">scrollKeys</span> <span class="o">=</span> <span class="o">{</span>
		<span class="m">37</span><span class="o">:</span> <span class="kc">true</span><span class="o">,</span>
		<span class="m">38</span><span class="o">:</span> <span class="kc">true</span><span class="o">,</span>
		<span class="m">39</span><span class="o">:</span> <span class="kc">true</span><span class="o">,</span>
		<span class="m">40</span><span class="o">:</span> <span class="kc">true</span>
	<span class="o">},</span>
	
	<span class="nx">clickableElements</span> <span class="o">=</span> <span class="o">{</span>
		<span class="s2">&quot;a&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="o">,</span>
		<span class="s2">&quot;button&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="o">,</span>
		<span class="s2">&quot;input&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="o">,</span>
		<span class="s2">&quot;object&quot;</span><span class="o">:</span> <span class="kc">true</span>
	<span class="o">},</span>	

	<span class="c">//	Library shortcuts</span>
<span class="c"></span>
	<span class="nx">Lang</span> <span class="o">=</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">Lang</span><span class="o">,</span>
 	<span class="nx">UA</span> <span class="o">=</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">UA</span><span class="o">,</span>

	<span class="c">/**</span>
<span class="c">	* The NodeFocusManager class is a plugin for a Node instance.  The class is used </span>
<span class="c">	* via the &lt;a href=&quot;Node.html#method_plug&quot;&gt;&lt;code&gt;plug&lt;/code&gt;&lt;/a&gt; method of Node </span>
<span class="c">	* and should not be instantiated directly.</span>
<span class="c">	* @namespace plugin</span>
<span class="c">	* @class NodeFocusManager</span>
<span class="c">	*/</span>	
	<span class="nx">NodeFocusManager</span> <span class="o">=</span> <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>

		<span class="nx">NodeFocusManager</span><span class="o">.</span><span class="nx">superclass</span><span class="o">.</span><span class="nx">constructor</span><span class="o">.</span><span class="nx">apply</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">arguments</span><span class="o">);</span>

	<span class="o">};</span>


<span class="nx">NodeFocusManager</span><span class="o">.</span><span class="nx">ATTRS</span> <span class="o">=</span> <span class="o">{</span>

	<span class="c">/**</span>
<span class="c">	* Boolean indicating that one of the descendants is focused.</span>
<span class="c">	*</span>
<span class="c">	* @attribute focused</span>
<span class="c">	* @readOnly</span>
<span class="c">	* @default false</span>
<span class="c">	* @type boolean</span>
<span class="c">	*/</span>
	<span class="nx">focused</span><span class="o">:</span> <span class="o">{</span>
		
		<span class="nx">value</span><span class="o">:</span> <span class="kc">false</span><span class="o">,</span>
		<span class="nx">readOnly</span><span class="o">:</span> <span class="kc">true</span>
		
	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* String representing the CSS selector used to define the descendant Nodes </span>
<span class="c">	* whose focus should be managed.</span>
<span class="c">	*</span>
<span class="c">	* @attribute descendants</span>
<span class="c">	* @type Y.NodeList</span>
<span class="c">	*/</span>
	<span class="nx">descendants</span><span class="o">:</span> <span class="o">{</span>

		<span class="nx">getter</span><span class="o">:</span> <span class="k">function</span> <span class="o">(</span><span class="nx">value</span><span class="o">)</span> <span class="o">{</span>

			<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">HOST</span><span class="o">).</span><span class="nx">all</span><span class="o">(</span><span class="nx">value</span><span class="o">);</span>
			
		<span class="o">}</span>

	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* &lt;p&gt;Node, or index of the Node, representing the descendant that is either </span>
<span class="c">	* focused or is focusable (&lt;code&gt;tabIndex&lt;/code&gt; attribute is set to 0).  </span>
<span class="c">	* The value cannot represent a disabled descendant Node.  Use a value of -1</span>
<span class="c">	* to remove all descendant Nodes from the default tab flow.</span>
<span class="c">	* If no value is specified, the active descendant will be inferred using </span>
<span class="c">	* the following criteria:&lt;/p&gt;</span>
<span class="c">	* &lt;ol&gt;</span>
<span class="c">	* &lt;li&gt;Examining the &lt;code&gt;tabIndex&lt;/code&gt; attribute of each descendant and </span>
<span class="c">	* using the first descendant whose &lt;code&gt;tabIndex&lt;/code&gt; attribute is set </span>
<span class="c">	* to 0&lt;/li&gt;</span>
<span class="c">	* &lt;li&gt;If no default can be inferred then the value is set to either 0 or </span>
<span class="c">	* the index of the first enabled descendant.&lt;/li&gt;</span>
<span class="c">	* &lt;/ol&gt;</span>
<span class="c">	* </span>
<span class="c">	* @attribute activeDescendant</span>
<span class="c">	* @type Number</span>
<span class="c">	*/</span>
	<span class="nx">activeDescendant</span><span class="o">:</span> <span class="o">{</span>

		<span class="nx">setter</span><span class="o">:</span> <span class="k">function</span> <span class="o">(</span><span class="nx">value</span><span class="o">)</span> <span class="o">{</span>
			
			<span class="k">var</span> <span class="nx">isNumber</span> <span class="o">=</span> <span class="nx">Lang</span><span class="o">.</span><span class="nx">isNumber</span><span class="o">,</span>
				<span class="nx">INVALID_VALUE</span> <span class="o">=</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">Attribute</span><span class="o">.</span><span class="nx">INVALID_VALUE</span><span class="o">,</span>
				<span class="nx">descendantsMap</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_descendantsMap</span><span class="o">,</span>
				<span class="nx">descendants</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_descendants</span><span class="o">,</span>
				<span class="nx">nodeIndex</span><span class="o">,</span>
				<span class="nx">returnValue</span><span class="o">,</span>
				<span class="nx">oNode</span><span class="o">;</span>
			

			<span class="k">if</span> <span class="o">(</span><span class="nx">isNumber</span><span class="o">(</span><span class="nx">value</span><span class="o">))</span> <span class="o">{</span>
				<span class="nx">nodeIndex</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
				<span class="nx">returnValue</span> <span class="o">=</span> <span class="nx">nodeIndex</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="o">((</span><span class="nx">value</span> <span class="k">instanceof</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">Node</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="nx">descendantsMap</span><span class="o">)</span> <span class="o">{</span>

				<span class="nx">nodeIndex</span> <span class="o">=</span> <span class="nx">descendantsMap</span><span class="o">[</span><span class="nx">value</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">ID</span><span class="o">)];</span>

				<span class="k">if</span> <span class="o">(</span><span class="nx">isNumber</span><span class="o">(</span><span class="nx">nodeIndex</span><span class="o">))</span> <span class="o">{</span>
					<span class="nx">returnValue</span> <span class="o">=</span> <span class="nx">nodeIndex</span><span class="o">;</span>
				<span class="o">}</span>
				<span class="k">else</span> <span class="o">{</span>

					<span class="c">//	The user passed a reference to a Node that wasn&#39;t one</span>
<span class="c"></span>					<span class="c">//	of the descendants.</span>
<span class="c"></span>					<span class="nx">returnValue</span> <span class="o">=</span> <span class="nx">INVALID_VALUE</span><span class="o">;</span>					

				<span class="o">}</span>

			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>
				<span class="nx">returnValue</span> <span class="o">=</span> <span class="nx">INVALID_VALUE</span><span class="o">;</span>
			<span class="o">}</span>


			<span class="k">if</span> <span class="o">(</span><span class="nx">descendants</span><span class="o">)</span> <span class="o">{</span>

				<span class="nx">oNode</span> <span class="o">=</span> <span class="nx">descendants</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="nx">nodeIndex</span><span class="o">);</span>
			
				<span class="k">if</span> <span class="o">(</span><span class="nx">oNode</span> <span class="o">&amp;&amp;</span> <span class="nx">oNode</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s2">&quot;disabled&quot;</span><span class="o">))</span> <span class="o">{</span>

					<span class="c">//	Setting the &quot;activeDescendant&quot; attribute to the index</span>
<span class="c"></span>					<span class="c">//	of a disabled descendant is invalid.</span>
<span class="c"></span>					<span class="nx">returnValue</span> <span class="o">=</span> <span class="nx">INVALID_VALUE</span><span class="o">;</span>
					
				<span class="o">}</span>

			<span class="o">}</span>

			<span class="k">return</span> <span class="nx">returnValue</span><span class="o">;</span>
			
		<span class="o">}</span>		

	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* Object literal representing the keys to be used to navigate between the </span>
<span class="c">	* next/previous descendant.  The format for the attribute&#39;s value is </span>
<span class="c">	* &lt;code&gt;{ next: &quot;down:40&quot;, previous: &quot;down:38&quot; }&lt;/code&gt;.  The value for the </span>
<span class="c">	* &quot;next&quot; and &quot;previous&quot; properties are used to attach </span>
<span class="c">	* &lt;a href=&quot;event/#keylistener&quot;&gt;&lt;code&gt;key&lt;/code&gt;&lt;/a&gt; event listeners. See </span>
<span class="c">	* the &lt;a href=&quot;event/#keylistener&quot;&gt;Using the key Event&lt;/a&gt; section of </span>
<span class="c">	* the Event documentation for more information on &quot;key&quot; event listeners.</span>
<span class="c">	* </span>
<span class="c">	* @attribute keys</span>
<span class="c">	* @type Object</span>
<span class="c">	*/</span>
	<span class="nx">keys</span><span class="o">:</span> <span class="o">{</span>
	
		<span class="nx">value</span><span class="o">:</span> <span class="o">{</span>

			<span class="nx">next</span><span class="o">:</span> <span class="kc">null</span><span class="o">,</span>
			<span class="nx">previous</span><span class="o">:</span> <span class="kc">null</span>
			
		<span class="o">}</span>

		
	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* String representing the name of class applied to the focused active  </span>
<span class="c">	* descendant Node.  Can also be an object literal used to define both the </span>
<span class="c">	* class name, and the Node to which the class should be applied.  If using </span>
<span class="c">	* an object literal, the format is:</span>
<span class="c">	* &lt;code&gt;{ className: &quot;focus&quot;, fn: myFunction }&lt;/code&gt;.  The function </span>
<span class="c">	* referenced by the &lt;code&gt;fn&lt;/code&gt; property in the object literal will be</span>
<span class="c">	* passed a reference to the currently focused active descendant Node.</span>
<span class="c">	* </span>
<span class="c">	* @attribute focusClass</span>
<span class="c">	* @type String|Object</span>
<span class="c">	*/</span>
	<span class="nx">focusClass</span><span class="o">:</span> <span class="o">{</span> <span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* Boolean indicating if focus should be set to the first/last descendant </span>
<span class="c">	* when the end or beginning of the descendants has been reached.</span>
<span class="c">	* </span>
<span class="c">	* @attribute circular</span>
<span class="c">	* @type Boolean</span>
<span class="c">	*/</span>
	<span class="nx">circular</span><span class="o">:</span> <span class="o">{</span>
		<span class="nx">value</span><span class="o">:</span> <span class="kc">true</span>
	<span class="o">}</span>
	
<span class="o">};</span>

<span class="nx">Y</span><span class="o">.</span><span class="nx">extend</span><span class="o">(</span><span class="nx">NodeFocusManager</span><span class="o">,</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">Plugin</span><span class="o">.</span><span class="nx">Base</span><span class="o">,</span> <span class="o">{</span>

	<span class="c">//	Protected properties</span>
<span class="c"></span>
	<span class="c">//	Boolean indicating if the NodeFocusManager is active.</span>
<span class="c"></span>	<span class="nx">_stopped</span><span class="o">:</span> <span class="kc">true</span><span class="o">,</span>

	<span class="c">//	NodeList representing the descendants selected via the </span>
<span class="c"></span>	<span class="c">//	&quot;descendants&quot; attribute.</span>
<span class="c"></span>	<span class="nx">_descendants</span><span class="o">:</span> <span class="kc">null</span><span class="o">,</span>
	
	<span class="c">//	Object literal mapping the IDs of each descendant to its index in the </span>
<span class="c"></span>	<span class="c">//	&quot;_descendants&quot; NodeList.</span>
<span class="c"></span>	<span class="nx">_descendantsMap</span><span class="o">:</span> <span class="kc">null</span><span class="o">,</span>

	<span class="c">//	Reference to the Node instance to which the focused class (defined </span>
<span class="c"></span>	<span class="c">//	by the &quot;focusClass&quot; attribute) is currently applied.</span>
<span class="c"></span>	<span class="nx">_focusedNode</span><span class="o">:</span> <span class="kc">null</span><span class="o">,</span>
	
	<span class="c">//	Number representing the index of the last descendant Node.</span>
<span class="c"></span>	<span class="nx">_lastNodeIndex</span><span class="o">:</span> <span class="m">0</span><span class="o">,</span>

	<span class="c">//	Array of handles for event handlers used for a NodeFocusManager instance.</span>
<span class="c"></span>	<span class="nx">_eventHandlers</span><span class="o">:</span> <span class="kc">null</span><span class="o">,</span>



	<span class="c">//	Protected methods</span>
<span class="c"></span>
	<span class="c">/**</span>
<span class="c">	* @method _initDescendants</span>
<span class="c">	* @description Sets the &lt;code&gt;tabIndex&lt;/code&gt; attribute of all of the </span>
<span class="c">	* descendants to -1, except the active descendant, whose </span>
<span class="c">	* &lt;code&gt;tabIndex&lt;/code&gt; attribute is set to 0.</span>
<span class="c">	* @protected</span>
<span class="c">	*/</span>
	<span class="nx">_initDescendants</span><span class="o">:</span> <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>

		<span class="k">var</span> <span class="nx">descendants</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s2">&quot;descendants&quot;</span><span class="o">),</span>
			<span class="nx">descendantsMap</span> <span class="o">=</span> <span class="o">{},</span>
			<span class="nx">nFirstEnabled</span> <span class="o">=</span> <span class="o">-</span><span class="m">1</span><span class="o">,</span>
			<span class="nx">nDescendants</span><span class="o">,</span>
			<span class="nx">nActiveDescendant</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">ACTIVE_DESCENDANT</span><span class="o">),</span>
			<span class="nx">oNode</span><span class="o">,</span>
			<span class="nx">sID</span><span class="o">,</span>
			<span class="nx">i</span> <span class="o">=</span> <span class="m">0</span><span class="o">;</span>



		<span class="k">if</span> <span class="o">(</span><span class="nx">Lang</span><span class="o">.</span><span class="nx">isUndefined</span><span class="o">(</span><span class="nx">nActiveDescendant</span><span class="o">))</span> <span class="o">{</span>
			<span class="nx">nActiveDescendant</span> <span class="o">=</span> <span class="o">-</span><span class="m">1</span><span class="o">;</span>
		<span class="o">}</span>


		<span class="k">if</span> <span class="o">(</span><span class="nx">descendants</span><span class="o">)</span> <span class="o">{</span>

			<span class="nx">nDescendants</span> <span class="o">=</span> <span class="nx">descendants</span><span class="o">.</span><span class="nx">size</span><span class="o">();</span>
			

			<span class="k">if</span> <span class="o">(</span><span class="nx">nDescendants</span> <span class="o">&gt;</span> <span class="m">1</span><span class="o">)</span> <span class="o">{</span>

				<span class="k">for</span> <span class="o">(</span><span class="nx">i</span> <span class="o">=</span> <span class="m">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">nDescendants</span><span class="o">;</span> <span class="nx">i</span><span class="o">++)</span> <span class="o">{</span>

					<span class="nx">oNode</span> <span class="o">=</span> <span class="nx">descendants</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="nx">i</span><span class="o">);</span>

					<span class="k">if</span> <span class="o">(</span><span class="nx">nFirstEnabled</span> <span class="o">===</span> <span class="o">-</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">oNode</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">DISABLED</span><span class="o">))</span> <span class="o">{</span>
						<span class="nx">nFirstEnabled</span> <span class="o">=</span> <span class="nx">i</span><span class="o">;</span>
					<span class="o">}</span>


					<span class="c">//	If the user didn&#39;t specify a value for the </span>
<span class="c"></span>					<span class="c">//	&quot;activeDescendant&quot; attribute try to infer it from </span>
<span class="c"></span>					<span class="c">//	the markup.</span>
<span class="c"></span>
					<span class="c">//	Need to pass &quot;2&quot; when using &quot;getAttribute&quot; for IE to get</span>
<span class="c"></span>					<span class="c">//	the attribute value as it is set in the markup.</span>
<span class="c"></span>					<span class="c">//	Need to use &quot;parseInt&quot; because IE always returns the </span>
<span class="c"></span>					<span class="c">//	value as a number, whereas all other browsers return</span>
<span class="c"></span>					<span class="c">//	the attribute as a string when accessed </span>
<span class="c"></span>					<span class="c">//	via &quot;getAttribute&quot;.</span>
<span class="c"></span>
					<span class="k">if</span> <span class="o">(</span><span class="nx">nActiveDescendant</span> <span class="o">&lt;</span> <span class="m">0</span> <span class="o">&amp;&amp;</span> 
							<span class="nb">parseInt</span><span class="o">(</span><span class="nx">oNode</span><span class="o">.</span><span class="nx">getAttribute</span><span class="o">(</span><span class="nx">TAB_INDEX</span><span class="o">,</span> <span class="m">2</span><span class="o">),</span> <span class="m">10</span><span class="o">)</span> <span class="o">===</span> <span class="m">0</span><span class="o">)</span> <span class="o">{</span>

						<span class="nx">nActiveDescendant</span> <span class="o">=</span> <span class="nx">i</span><span class="o">;</span>

					<span class="o">}</span>

					<span class="nx">oNode</span><span class="o">.</span><span class="nx">set</span><span class="o">(</span><span class="nx">TAB_INDEX</span><span class="o">,</span> <span class="o">-</span><span class="m">1</span><span class="o">);</span>

					<span class="nx">sID</span> <span class="o">=</span> <span class="nx">oNode</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">ID</span><span class="o">);</span>

					<span class="k">if</span> <span class="o">(!</span><span class="nx">sID</span><span class="o">)</span> <span class="o">{</span>
						<span class="nx">sID</span> <span class="o">=</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">guid</span><span class="o">();</span>
						<span class="nx">oNode</span><span class="o">.</span><span class="nx">set</span><span class="o">(</span><span class="nx">ID</span><span class="o">,</span> <span class="nx">sID</span><span class="o">);</span>
					<span class="o">}</span>
					
					<span class="nx">descendantsMap</span><span class="o">[</span><span class="nx">sID</span><span class="o">]</span> <span class="o">=</span> <span class="nx">i</span><span class="o">;</span>
					
				<span class="o">}</span>
				

				<span class="c">//	If the user didn&#39;t specify a value for the  </span>
<span class="c"></span>				<span class="c">//	&quot;activeDescendant&quot; attribute and no default value could be </span>
<span class="c"></span>				<span class="c">//	determined from the markup, then default to 0.</span>
<span class="c"></span>				
				<span class="k">if</span> <span class="o">(</span><span class="nx">nActiveDescendant</span> <span class="o">&lt;</span> <span class="m">0</span><span class="o">)</span> <span class="o">{</span>
					<span class="nx">nActiveDescendant</span> <span class="o">=</span> <span class="m">0</span><span class="o">;</span>
				<span class="o">}</span>
				

				<span class="nx">oNode</span> <span class="o">=</span> <span class="nx">descendants</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="nx">nActiveDescendant</span><span class="o">);</span>

				<span class="c">//	Check to make sure the active descendant isn&#39;t disabled, </span>
<span class="c"></span>				<span class="c">//	and fall back to the first enabled descendant if it is.</span>
<span class="c"></span>
				<span class="k">if</span> <span class="o">(!</span><span class="nx">oNode</span> <span class="o">||</span> <span class="nx">oNode</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">DISABLED</span><span class="o">))</span> <span class="o">{</span>
					<span class="nx">oNode</span> <span class="o">=</span> <span class="nx">descendants</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="nx">nFirstEnabled</span><span class="o">);</span>
					<span class="nx">nActiveDescendant</span> <span class="o">=</span> <span class="nx">nFirstEnabled</span><span class="o">;</span>
				<span class="o">}</span>

				<span class="k">this</span><span class="o">.</span><span class="nx">_lastNodeIndex</span> <span class="o">=</span> <span class="nx">nDescendants</span> <span class="o">-</span> <span class="m">1</span><span class="o">;</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">_descendants</span> <span class="o">=</span> <span class="nx">descendants</span><span class="o">;</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">_descendantsMap</span> <span class="o">=</span> <span class="nx">descendantsMap</span><span class="o">;</span>

				<span class="k">this</span><span class="o">.</span><span class="nx">set</span><span class="o">(</span><span class="nx">ACTIVE_DESCENDANT</span><span class="o">,</span> <span class="nx">nActiveDescendant</span><span class="o">);</span>

				<span class="c">//	Need to set the &quot;tabIndex&quot; attribute here, since the </span>
<span class="c"></span>				<span class="c">//	&quot;activeDescendantChange&quot; event handler used to manage</span>
<span class="c"></span>				<span class="c">//	the setting of the &quot;tabIndex&quot; attribute isn&#39;t wired up yet.</span>
<span class="c"></span>
				<span class="nx">oNode</span><span class="o">.</span><span class="nx">set</span><span class="o">(</span><span class="nx">TAB_INDEX</span><span class="o">,</span> <span class="m">0</span><span class="o">);</span>

			<span class="o">}</span>
			
		<span class="o">}</span>

	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method _isDescendant</span>
<span class="c">	* @description Determines if the specified Node instance is a descendant</span>
<span class="c">	* managed by the Focus Manager.</span>
<span class="c">	* @param node {Node} Node instance to be checked.</span>
<span class="c">	* @return {Boolean} Boolean indicating if the specified Node instance is a </span>
<span class="c">	* descendant managed by the Focus Manager.</span>
<span class="c">	* @protected</span>
<span class="c">	*/</span>
	<span class="nx">_isDescendant</span><span class="o">:</span> <span class="k">function</span> <span class="o">(</span><span class="nx">node</span><span class="o">)</span> <span class="o">{</span>

		<span class="k">return</span> <span class="o">(</span><span class="nx">node</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">ID</span><span class="o">)</span> <span class="k">in</span> <span class="k">this</span><span class="o">.</span><span class="nx">_descendantsMap</span><span class="o">);</span>
		
	<span class="o">},</span>
	

	<span class="c">/**</span>
<span class="c">	* @method _removeFocusClass</span>
<span class="c">	* @description Removes the class name representing focus (as specified by </span>
<span class="c">	* the &quot;focusClass&quot; attribute) from the Node instance to which it is </span>
<span class="c">	* currently applied.</span>
<span class="c">	* @protected</span>
<span class="c">	*/</span>
	<span class="nx">_removeFocusClass</span><span class="o">:</span> <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>

		<span class="k">var</span> <span class="nx">oFocusedNode</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_focusedNode</span><span class="o">,</span>
			<span class="nx">focusClass</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">FOCUS_CLASS</span><span class="o">),</span>
			<span class="nx">sClassName</span><span class="o">;</span>

		<span class="k">if</span> <span class="o">(</span><span class="nx">focusClass</span><span class="o">)</span> <span class="o">{</span>
			<span class="nx">sClassName</span> <span class="o">=</span> <span class="nx">Lang</span><span class="o">.</span><span class="nx">isString</span><span class="o">(</span><span class="nx">focusClass</span><span class="o">)</span> <span class="o">?</span> 
				<span class="nx">focusClass</span> <span class="o">:</span> <span class="nx">focusClass</span><span class="o">.</span><span class="nx">className</span><span class="o">;</span>		
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="nx">oFocusedNode</span> <span class="o">&amp;&amp;</span> <span class="nx">sClassName</span><span class="o">)</span> <span class="o">{</span>
			<span class="nx">oFocusedNode</span><span class="o">.</span><span class="nx">removeClass</span><span class="o">(</span><span class="nx">sClassName</span><span class="o">);</span>
		<span class="o">}</span>
		
	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method _detachKeyHandler</span>
<span class="c">	* @description Detaches the &quot;key&quot; event handlers used to support the &quot;keys&quot;</span>
<span class="c">	* attribute.</span>
<span class="c">	* @protected</span>
<span class="c">	*/</span>
	<span class="nx">_detachKeyHandler</span><span class="o">:</span> <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>

		<span class="k">var</span> <span class="nx">prevKeyHandler</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_prevKeyHandler</span><span class="o">,</span>
			<span class="nx">nextKeyHandler</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_nextKeyHandler</span><span class="o">;</span>

		<span class="k">if</span> <span class="o">(</span><span class="nx">prevKeyHandler</span><span class="o">)</span> <span class="o">{</span>
			<span class="nx">prevKeyHandler</span><span class="o">.</span><span class="nx">detach</span><span class="o">();</span>
		<span class="o">}</span>
		
		<span class="k">if</span> <span class="o">(</span><span class="nx">nextKeyHandler</span><span class="o">)</span> <span class="o">{</span>
			<span class="nx">nextKeyHandler</span><span class="o">.</span><span class="nx">detach</span><span class="o">();</span>
		<span class="o">}</span>
		
	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method _preventScroll</span>
<span class="c">	* @description Prevents the viewport from scolling when the user presses </span>
<span class="c">	* the up, down, left, or right key.</span>
<span class="c">	* @protected</span>
<span class="c">	*/</span>
	<span class="nx">_preventScroll</span><span class="o">:</span> <span class="k">function</span> <span class="o">(</span><span class="nx">event</span><span class="o">)</span> <span class="o">{</span>

		<span class="k">if</span> <span class="o">(</span><span class="nx">scrollKeys</span><span class="o">[</span><span class="nx">event</span><span class="o">.</span><span class="nx">keyCode</span><span class="o">])</span> <span class="o">{</span>
			<span class="nx">event</span><span class="o">.</span><span class="nx">preventDefault</span><span class="o">();</span>
		<span class="o">}</span>
		
	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method _preventScroll</span>
<span class="c">	* @description Fires the click event if the enter key is pressed while </span>
<span class="c">	* focused on an HTML element that is not natively clickable.</span>
<span class="c">	* @protected</span>
<span class="c">	*/</span>
	<span class="nx">_fireClick</span><span class="o">:</span> <span class="k">function</span> <span class="o">(</span><span class="nx">event</span><span class="o">)</span> <span class="o">{</span>
		
		<span class="k">var</span> <span class="nx">oTarget</span> <span class="o">=</span> <span class="nx">event</span><span class="o">.</span><span class="nx">target</span><span class="o">,</span>
			<span class="nx">sNodeName</span> <span class="o">=</span> <span class="nx">oTarget</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s2">&quot;nodeName&quot;</span><span class="o">).</span><span class="nx">toLowerCase</span><span class="o">();</span>

		<span class="k">if</span> <span class="o">(</span><span class="nx">event</span><span class="o">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="m">13</span> <span class="o">&amp;&amp;</span> <span class="o">(!</span><span class="nx">clickableElements</span><span class="o">[</span><span class="nx">sNodeName</span><span class="o">]</span> <span class="o">||</span> 
				<span class="o">(</span><span class="nx">sNodeName</span> <span class="o">===</span> <span class="s2">&quot;a&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">oTarget</span><span class="o">.</span><span class="nx">getAttribute</span><span class="o">(</span><span class="s2">&quot;href&quot;</span><span class="o">))))</span> <span class="o">{</span>

			<span class="nx">Y</span><span class="o">.</span><span class="nx">log</span><span class="o">((</span><span class="s2">&quot;Firing click event for node:&quot;</span> <span class="o">+</span> <span class="nx">oTarget</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s2">&quot;id&quot;</span><span class="o">)),</span> <span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;nodeFocusManager&quot;</span><span class="o">);</span>

			<span class="nx">oTarget</span><span class="o">.</span><span class="nx">simulate</span><span class="o">(</span><span class="s2">&quot;click&quot;</span><span class="o">);</span>
			
		<span class="o">}</span>
		
	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method _attachKeyHandler</span>
<span class="c">	* @description Attaches the &quot;key&quot; event handlers used to support the &quot;keys&quot;</span>
<span class="c">	* attribute.</span>
<span class="c">	* @protected</span>
<span class="c">	*/</span>
	<span class="nx">_attachKeyHandler</span><span class="o">:</span> <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>

		<span class="k">this</span><span class="o">.</span><span class="nx">_detachKeyHandler</span><span class="o">();</span>

		<span class="k">var</span> <span class="nx">sNextKey</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s2">&quot;keys.next&quot;</span><span class="o">),</span>
			<span class="nx">sPrevKey</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s2">&quot;keys.previous&quot;</span><span class="o">),</span>
			<span class="nx">oNode</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">HOST</span><span class="o">),</span>
			<span class="nx">aHandlers</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_eventHandlers</span><span class="o">;</span>

		<span class="k">if</span> <span class="o">(</span><span class="nx">sPrevKey</span><span class="o">)</span> <span class="o">{</span>
 			<span class="k">this</span><span class="o">.</span><span class="nx">_prevKeyHandler</span> <span class="o">=</span> 
				<span class="nx">Y</span><span class="o">.</span><span class="nx">on</span><span class="o">(</span><span class="nx">KEY</span><span class="o">,</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">bind</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_focusPrevious</span><span class="o">,</span> <span class="k">this</span><span class="o">),</span> <span class="nx">oNode</span><span class="o">,</span> <span class="nx">sPrevKey</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="nx">sNextKey</span><span class="o">)</span> <span class="o">{</span>
 			<span class="k">this</span><span class="o">.</span><span class="nx">_nextKeyHandler</span> <span class="o">=</span> 
				<span class="nx">Y</span><span class="o">.</span><span class="nx">on</span><span class="o">(</span><span class="nx">KEY</span><span class="o">,</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">bind</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_focusNext</span><span class="o">,</span> <span class="k">this</span><span class="o">),</span> <span class="nx">oNode</span><span class="o">,</span> <span class="nx">sNextKey</span><span class="o">);</span>
		<span class="o">}</span>


		<span class="c">//	In Opera it is necessary to call the &quot;preventDefault&quot; method in  </span>
<span class="c"></span>		<span class="c">//	response to the user pressing the arrow keys in order to prevent </span>
<span class="c"></span>		<span class="c">//	the viewport from scrolling when the user is moving focus among </span>
<span class="c"></span>		<span class="c">//	the focusable descendants.</span>
<span class="c"></span>		
		<span class="k">if</span> <span class="o">(</span><span class="nx">UA</span><span class="o">.</span><span class="nx">opera</span><span class="o">)</span> <span class="o">{</span>	
			<span class="nx">aHandlers</span><span class="o">.</span><span class="nx">push</span><span class="o">(</span><span class="nx">oNode</span><span class="o">.</span><span class="nx">on</span><span class="o">(</span><span class="s2">&quot;keypress&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="nx">_preventScroll</span><span class="o">,</span> <span class="k">this</span><span class="o">));</span>
		<span class="o">}</span>


		<span class="c">//	For all browsers except Opera: HTML elements that are not natively</span>
<span class="c"></span>		<span class="c">//	focusable but made focusable via the tabIndex attribute don&#39;t </span>
<span class="c"></span>		<span class="c">//	fire a click event when the user presses the enter key.  It is </span>
<span class="c"></span>		<span class="c">//	possible to work around this problem by simplying dispatching a </span>
<span class="c"></span>		<span class="c">//	click event in response to the user pressing the enter key.</span>
<span class="c"></span>
		<span class="k">if</span> <span class="o">(!</span><span class="nx">UA</span><span class="o">.</span><span class="nx">opera</span><span class="o">)</span> <span class="o">{</span>
			<span class="nx">aHandlers</span><span class="o">.</span><span class="nx">push</span><span class="o">(</span><span class="nx">oNode</span><span class="o">.</span><span class="nx">on</span><span class="o">(</span><span class="s2">&quot;keypress&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="nx">_fireClick</span><span class="o">,</span> <span class="k">this</span><span class="o">));</span>
		<span class="o">}</span>

	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method _detachEventHandlers</span>
<span class="c">	* @description Detaches all event handlers used by the Focus Manager.</span>
<span class="c">	* @protected</span>
<span class="c">	*/</span>
	<span class="nx">_detachEventHandlers</span><span class="o">:</span> <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>

		<span class="k">this</span><span class="o">.</span><span class="nx">_detachKeyHandler</span><span class="o">();</span>

		<span class="k">var</span> <span class="nx">aHandlers</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_eventHandlers</span><span class="o">;</span>

		<span class="k">if</span> <span class="o">(</span><span class="nx">aHandlers</span><span class="o">)</span> <span class="o">{</span>

			<span class="nx">Y</span><span class="o">.</span><span class="nb">Array</span><span class="o">.</span><span class="nx">each</span><span class="o">(</span><span class="nx">aHandlers</span><span class="o">,</span> <span class="k">function</span> <span class="o">(</span><span class="nx">handle</span><span class="o">)</span> <span class="o">{</span>
				<span class="nx">handle</span><span class="o">.</span><span class="nx">detach</span><span class="o">();</span>
			<span class="o">});</span>

			<span class="k">this</span><span class="o">.</span><span class="nx">_eventHandlers</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

		<span class="o">}</span>
		
	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method _detachEventHandlers</span>
<span class="c">	* @description Attaches all event handlers used by the Focus Manager.</span>
<span class="c">	* @protected	</span>
<span class="c">	*/</span>
	<span class="nx">_attachEventHandlers</span><span class="o">:</span> <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>

		<span class="k">var</span> <span class="nx">descendants</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_descendants</span><span class="o">,</span>
			<span class="nx">aHandlers</span><span class="o">,</span>
			<span class="nx">oDocument</span><span class="o">,</span>
			<span class="nx">handle</span><span class="o">;</span>

		<span class="k">if</span> <span class="o">(</span><span class="nx">descendants</span> <span class="o">&amp;&amp;</span> <span class="nx">descendants</span><span class="o">.</span><span class="nx">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="m">1</span><span class="o">)</span> <span class="o">{</span>

			<span class="nx">aHandlers</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_eventHandlers</span> <span class="o">||</span> <span class="o">[];</span>
			<span class="nx">oDocument</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">HOST</span><span class="o">).</span><span class="nx">get</span><span class="o">(</span><span class="s2">&quot;ownerDocument&quot;</span><span class="o">);</span>


			<span class="k">if</span> <span class="o">(</span><span class="nx">aHandlers</span><span class="o">.</span><span class="nx">length</span> <span class="o">===</span> <span class="m">0</span><span class="o">)</span> <span class="o">{</span>

		        <span class="nx">Y</span><span class="o">.</span><span class="nx">log</span><span class="o">(</span><span class="s2">&quot;Attaching base set of event handlers.&quot;</span><span class="o">,</span> <span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;nodeFocusManager&quot;</span><span class="o">);</span>

				<span class="nx">aHandlers</span><span class="o">.</span><span class="nx">push</span><span class="o">(</span><span class="nx">oDocument</span><span class="o">.</span><span class="nx">on</span><span class="o">(</span><span class="s2">&quot;focus&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="nx">_onDocFocus</span><span class="o">,</span> <span class="k">this</span><span class="o">));</span>

				<span class="nx">aHandlers</span><span class="o">.</span><span class="nx">push</span><span class="o">(</span><span class="nx">oDocument</span><span class="o">.</span><span class="nx">on</span><span class="o">(</span><span class="s2">&quot;mousedown&quot;</span><span class="o">,</span> 
					<span class="k">this</span><span class="o">.</span><span class="nx">_onDocMouseDown</span><span class="o">,</span> <span class="k">this</span><span class="o">));</span>

				<span class="nx">aHandlers</span><span class="o">.</span><span class="nx">push</span><span class="o">(</span>
						<span class="k">this</span><span class="o">.</span><span class="nx">after</span><span class="o">(</span><span class="s2">&quot;keysChange&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="nx">_attachKeyHandler</span><span class="o">));</span>

				<span class="nx">aHandlers</span><span class="o">.</span><span class="nx">push</span><span class="o">(</span>
						<span class="k">this</span><span class="o">.</span><span class="nx">after</span><span class="o">(</span><span class="s2">&quot;descendantsChange&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="nx">_initDescendants</span><span class="o">));</span>

				<span class="nx">aHandlers</span><span class="o">.</span><span class="nx">push</span><span class="o">(</span>
						<span class="k">this</span><span class="o">.</span><span class="nx">after</span><span class="o">(</span><span class="nx">ACTIVE_DESCENDANT_CHANGE</span><span class="o">,</span> 
								<span class="k">this</span><span class="o">.</span><span class="nx">_afterActiveDescendantChange</span><span class="o">));</span>


				<span class="c">//	For performance: defer attaching all key-related event </span>
<span class="c"></span>				<span class="c">//	handlers until the first time one of the specified </span>
<span class="c"></span>				<span class="c">//	descendants receives focus.</span>
<span class="c"></span>
				<span class="nx">handle</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">after</span><span class="o">(</span><span class="s2">&quot;focusedChange&quot;</span><span class="o">,</span> <span class="nx">Y</span><span class="o">.</span><span class="nx">bind</span><span class="o">(</span><span class="k">function</span> <span class="o">(</span><span class="nx">event</span><span class="o">)</span> <span class="o">{</span>
					
					<span class="k">if</span> <span class="o">(</span><span class="nx">event</span><span class="o">.</span><span class="nx">newVal</span><span class="o">)</span> <span class="o">{</span>
						
				        <span class="nx">Y</span><span class="o">.</span><span class="nx">log</span><span class="o">(</span><span class="s2">&quot;Attaching key event handlers.&quot;</span><span class="o">,</span> <span class="s2">&quot;info&quot;</span><span class="o">,</span> <span class="s2">&quot;nodeFocusManager&quot;</span><span class="o">);</span>
						
						<span class="k">this</span><span class="o">.</span><span class="nx">_attachKeyHandler</span><span class="o">();</span>

						<span class="c">//	Detach this &quot;focusedChange&quot; handler so that the </span>
<span class="c"></span>						<span class="c">//	key-related handlers only get attached once.</span>
<span class="c"></span>
						<span class="nx">handle</span><span class="o">.</span><span class="nx">detach</span><span class="o">();</span>

					<span class="o">}</span>
					
				<span class="o">},</span> <span class="k">this</span><span class="o">));</span>
				
				<span class="nx">aHandlers</span><span class="o">.</span><span class="nx">push</span><span class="o">(</span><span class="nx">handle</span><span class="o">);</span>
				
			<span class="o">}</span>


			<span class="k">this</span><span class="o">.</span><span class="nx">_eventHandlers</span> <span class="o">=</span> <span class="nx">aHandlers</span><span class="o">;</span>
			
		<span class="o">}</span>
		
	<span class="o">},</span>	
	
	
	<span class="c">//	Protected event handlers</span>
<span class="c"></span>
	<span class="c">/**</span>
<span class="c">	* @method _onDocMouseDown</span>
<span class="c">	* @description &quot;mousedown&quot; event handler for the owner document of the </span>
<span class="c">	* Focus Manager&#39;s Node.</span>
<span class="c">	* @protected</span>
<span class="c">	* @param event {Object} Object representing the DOM event.</span>
<span class="c">	*/</span>
	<span class="nx">_onDocMouseDown</span><span class="o">:</span> <span class="k">function</span> <span class="o">(</span><span class="nx">event</span><span class="o">)</span> <span class="o">{</span>
	
		<span class="k">var</span> <span class="nx">oHost</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">HOST</span><span class="o">),</span>
			<span class="nx">oTarget</span> <span class="o">=</span> <span class="nx">event</span><span class="o">.</span><span class="nx">target</span><span class="o">,</span>
			<span class="nx">bChildNode</span> <span class="o">=</span> <span class="nx">oHost</span><span class="o">.</span><span class="nx">contains</span><span class="o">(</span><span class="nx">oTarget</span><span class="o">),</span>
			<span class="nx">node</span><span class="o">,</span>

			<span class="nx">getFocusable</span> <span class="o">=</span> <span class="k">function</span> <span class="o">(</span><span class="nx">node</span><span class="o">)</span> <span class="o">{</span>

				<span class="k">var</span> <span class="nx">returnVal</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

				<span class="k">if</span> <span class="o">(!</span><span class="nx">node</span><span class="o">.</span><span class="nx">compareTo</span><span class="o">(</span><span class="nx">oHost</span><span class="o">))</span> <span class="o">{</span>
					
					<span class="nx">returnVal</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_isDescendant</span><span class="o">(</span><span class="nx">node</span><span class="o">)</span> <span class="o">?</span> <span class="nx">node</span> <span class="o">:</span> 
									<span class="nx">getFocusable</span><span class="o">.</span><span class="nx">call</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">node</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s2">&quot;parentNode&quot;</span><span class="o">));</span>

				<span class="o">}</span>
		
				<span class="k">return</span> <span class="nx">returnVal</span><span class="o">;</span>

			<span class="o">};</span>
		

		<span class="k">if</span> <span class="o">(</span><span class="nx">bChildNode</span><span class="o">)</span> <span class="o">{</span>

			<span class="c">//	Check to make sure that the target isn&#39;t a child node of one </span>
<span class="c"></span>			<span class="c">//	of the focusable descendants.</span>
<span class="c"></span>
			<span class="nx">node</span> <span class="o">=</span> <span class="nx">getFocusable</span><span class="o">.</span><span class="nx">call</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">oTarget</span><span class="o">);</span>

			<span class="k">if</span> <span class="o">(</span><span class="nx">node</span><span class="o">)</span> <span class="o">{</span>
				<span class="nx">oTarget</span> <span class="o">=</span> <span class="nx">node</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">FOCUSED</span><span class="o">))</span> <span class="o">{</span>

				<span class="c">//	The target was a non-focusable descendant of the root </span>
<span class="c"></span>				<span class="c">//	node, so the &quot;focused&quot; attribute should be set to false.</span>
<span class="c"></span>
	 			<span class="k">this</span><span class="o">.</span><span class="nx">_set</span><span class="o">(</span><span class="nx">FOCUSED</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
	 			<span class="k">this</span><span class="o">.</span><span class="nx">_onDocFocus</span><span class="o">(</span><span class="nx">event</span><span class="o">);</span>
								
			<span class="o">}</span>

		<span class="o">}</span>
		

		<span class="k">if</span> <span class="o">(</span><span class="nx">bChildNode</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="nx">_isDescendant</span><span class="o">(</span><span class="nx">oTarget</span><span class="o">))</span> <span class="o">{</span>

			<span class="c">//	Fix general problem in Webkit: mousing down on a button or an </span>
<span class="c"></span>			<span class="c">//	anchor element doesn&#39;t focus it.</span>
<span class="c"></span>
			<span class="c">//	For all browsers: makes sure that the descendant that </span>
<span class="c"></span>			<span class="c">//	was the target of the mousedown event is now considered the</span>
<span class="c"></span>			<span class="c">//	active descendant.</span>
<span class="c"></span>
			<span class="k">this</span><span class="o">.</span><span class="nx">focus</span><span class="o">(</span><span class="nx">oTarget</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="nx">UA</span><span class="o">.</span><span class="nx">webkit</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">FOCUSED</span><span class="o">)</span> <span class="o">&amp;&amp;</span> 
			<span class="o">(!</span><span class="nx">bChildNode</span> <span class="o">||</span> <span class="o">(</span><span class="nx">bChildNode</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="o">.</span><span class="nx">_isDescendant</span><span class="o">(</span><span class="nx">oTarget</span><span class="o">))))</span> <span class="o">{</span>

			<span class="c">//	Fix for Webkit:</span>
<span class="c"></span>			
			<span class="c">//	Document doesn&#39;t receive focus in Webkit when the user mouses </span>
<span class="c"></span>			<span class="c">//	down on it, so the &quot;focused&quot; attribute won&#39;t get set to the </span>
<span class="c"></span>			<span class="c">//	correct value.</span>
<span class="c"></span>
			<span class="c">//	The goal is to force a blur if the user moused down on </span>
<span class="c"></span>			<span class="c">//	either: 1) A descendant node, but not one that managed by </span>
<span class="c"></span>			<span class="c">//	the FocusManager, or 2) an element outside of the </span>
<span class="c"></span>			<span class="c">//	FocusManager</span>
<span class="c"></span>
 			<span class="k">this</span><span class="o">.</span><span class="nx">_set</span><span class="o">(</span><span class="nx">FOCUSED</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
 			<span class="k">this</span><span class="o">.</span><span class="nx">_onDocFocus</span><span class="o">(</span><span class="nx">event</span><span class="o">);</span>

		<span class="o">}</span>
	
	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method _onDocFocus</span>
<span class="c">	* @description &quot;focus&quot; event handler for the owner document of the </span>
<span class="c">	* Focus Manager&#39;s Node.</span>
<span class="c">	* @protected</span>
<span class="c">	* @param event {Object} Object representing the DOM event.</span>
<span class="c">	*/</span>
	<span class="nx">_onDocFocus</span><span class="o">:</span> <span class="k">function</span> <span class="o">(</span><span class="nx">event</span><span class="o">)</span> <span class="o">{</span>

		<span class="k">var</span> <span class="nx">oTarget</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_focusTarget</span> <span class="o">||</span> <span class="nx">event</span><span class="o">.</span><span class="nx">target</span><span class="o">,</span>
			<span class="nx">bFocused</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">FOCUSED</span><span class="o">),</span>
			<span class="nx">focusClass</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">FOCUS_CLASS</span><span class="o">),</span>
			<span class="nx">oFocusedNode</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_focusedNode</span><span class="o">,</span>
			<span class="nx">bInCollection</span><span class="o">;</span>

		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_focusTarget</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">_focusTarget</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>


		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">HOST</span><span class="o">).</span><span class="nx">contains</span><span class="o">(</span><span class="nx">oTarget</span><span class="o">))</span> <span class="o">{</span>	

			<span class="c">//	The target is a descendant of the root Node.</span>
<span class="c"></span>
			<span class="nx">bInCollection</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_isDescendant</span><span class="o">(</span><span class="nx">oTarget</span><span class="o">);</span>

			<span class="k">if</span> <span class="o">(!</span><span class="nx">bFocused</span> <span class="o">&amp;&amp;</span> <span class="nx">bInCollection</span><span class="o">)</span> <span class="o">{</span>

				<span class="c">//	The user has focused a focusable descendant.</span>
<span class="c"></span>
				<span class="nx">bFocused</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

			<span class="o">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="nx">bFocused</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">bInCollection</span><span class="o">)</span> <span class="o">{</span>  
			
				<span class="c">//	The user has focused a child of the root Node that is </span>
<span class="c"></span>				<span class="c">//	not one of the descendants managed by this Focus Manager</span>
<span class="c"></span>				<span class="c">//	so clear the currently focused descendant.</span>
<span class="c"></span>				
				<span class="nx">bFocused</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
			
			<span class="o">}</span>
			
		<span class="o">}</span>
		<span class="k">else</span> <span class="o">{</span> 
		
			<span class="c">// The target is some other node in the document.</span>
<span class="c"></span>
			<span class="nx">bFocused</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
			
		<span class="o">}</span>


		<span class="k">if</span> <span class="o">(</span><span class="nx">focusClass</span><span class="o">)</span> <span class="o">{</span>

			<span class="k">if</span> <span class="o">(</span><span class="nx">oFocusedNode</span> <span class="o">&amp;&amp;</span> <span class="o">(!</span><span class="nx">oFocusedNode</span><span class="o">.</span><span class="nx">compareTo</span><span class="o">(</span><span class="nx">oTarget</span><span class="o">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">bFocused</span><span class="o">))</span> <span class="o">{</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">_removeFocusClass</span><span class="o">();</span>
			<span class="o">}</span>

			<span class="k">if</span> <span class="o">(</span><span class="nx">bInCollection</span> <span class="o">&amp;&amp;</span> <span class="nx">bFocused</span><span class="o">)</span> <span class="o">{</span>

				<span class="k">if</span> <span class="o">(</span><span class="nx">focusClass</span><span class="o">.</span><span class="nx">fn</span><span class="o">)</span> <span class="o">{</span>
					<span class="nx">oTarget</span> <span class="o">=</span> <span class="nx">focusClass</span><span class="o">.</span><span class="nx">fn</span><span class="o">(</span><span class="nx">oTarget</span><span class="o">);</span>
					<span class="nx">oTarget</span><span class="o">.</span><span class="nx">addClass</span><span class="o">(</span><span class="nx">focusClass</span><span class="o">.</span><span class="nx">className</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="k">else</span> <span class="o">{</span>
					<span class="nx">oTarget</span><span class="o">.</span><span class="nx">addClass</span><span class="o">(</span><span class="nx">focusClass</span><span class="o">);</span>
				<span class="o">}</span>

				<span class="k">this</span><span class="o">.</span><span class="nx">_focusedNode</span> <span class="o">=</span> <span class="nx">oTarget</span><span class="o">;</span>

			<span class="o">}</span>
			
		<span class="o">}</span>


		<span class="k">this</span><span class="o">.</span><span class="nx">_set</span><span class="o">(</span><span class="nx">FOCUSED</span><span class="o">,</span> <span class="nx">bFocused</span><span class="o">);</span>			

	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method _focusNext</span>
<span class="c">	* @description Keydown event handler that moves focus to the next </span>
<span class="c">	* enabled descendant.</span>
<span class="c">	* @protected</span>
<span class="c">	* @param event {Object} Object representing the DOM event.</span>
<span class="c">	* @param activeDescendant {Number} Number representing the index of the </span>
<span class="c">	* next descendant to be focused</span>
<span class="c">	*/</span>
	<span class="nx">_focusNext</span><span class="o">:</span> <span class="k">function</span> <span class="o">(</span><span class="nx">event</span><span class="o">,</span> <span class="nx">activeDescendant</span><span class="o">)</span> <span class="o">{</span>

		<span class="k">var</span> <span class="nx">nActiveDescendant</span> <span class="o">=</span> <span class="nx">activeDescendant</span> <span class="o">||</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">ACTIVE_DESCENDANT</span><span class="o">),</span>
			<span class="nx">oNode</span><span class="o">;</span>


		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_isDescendant</span><span class="o">(</span><span class="nx">event</span><span class="o">.</span><span class="nx">target</span><span class="o">)</span> <span class="o">&amp;&amp;</span> 
			<span class="o">(</span><span class="nx">nActiveDescendant</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_lastNodeIndex</span><span class="o">))</span> <span class="o">{</span>

			<span class="nx">nActiveDescendant</span> <span class="o">=</span> <span class="nx">nActiveDescendant</span> <span class="o">+</span> <span class="m">1</span><span class="o">;</span>

			<span class="k">if</span> <span class="o">(</span><span class="nx">nActiveDescendant</span> <span class="o">===</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_lastNodeIndex</span> <span class="o">+</span> <span class="m">1</span><span class="o">)</span> <span class="o">&amp;&amp;</span> 
				<span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">CIRCULAR</span><span class="o">))</span> <span class="o">{</span>

				<span class="nx">nActiveDescendant</span> <span class="o">=</span> <span class="m">0</span><span class="o">;</span>

			<span class="o">}</span>

			<span class="nx">oNode</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_descendants</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="nx">nActiveDescendant</span><span class="o">);</span>
			
			<span class="k">if</span> <span class="o">(</span><span class="nx">oNode</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">DISABLED</span><span class="o">))</span> <span class="o">{</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">_focusNext</span><span class="o">(</span><span class="nx">event</span><span class="o">,</span> <span class="nx">nActiveDescendant</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">focus</span><span class="o">(</span><span class="nx">nActiveDescendant</span><span class="o">);</span>
			<span class="o">}</span>

		<span class="o">}</span>
		
		<span class="k">this</span><span class="o">.</span><span class="nx">_preventScroll</span><span class="o">(</span><span class="nx">event</span><span class="o">);</span>

	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method _focusPrevious</span>
<span class="c">	* @description Keydown event handler that moves focus to the previous </span>
<span class="c">	* enabled descendant.</span>
<span class="c">	* @protected</span>
<span class="c">	* @param event {Object} Object representing the DOM event.</span>
<span class="c">	* @param activeDescendant {Number} Number representing the index of the </span>
<span class="c">	* next descendant to be focused.</span>
<span class="c">	*/</span>
	<span class="nx">_focusPrevious</span><span class="o">:</span> <span class="k">function</span> <span class="o">(</span><span class="nx">event</span><span class="o">,</span> <span class="nx">activeDescendant</span><span class="o">)</span> <span class="o">{</span>
	
		<span class="k">var</span> <span class="nx">nActiveDescendant</span> <span class="o">=</span> <span class="nx">activeDescendant</span> <span class="o">||</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">ACTIVE_DESCENDANT</span><span class="o">),</span>
			<span class="nx">oNode</span><span class="o">;</span>
	
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_isDescendant</span><span class="o">(</span><span class="nx">event</span><span class="o">.</span><span class="nx">target</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="nx">nActiveDescendant</span> <span class="o">&gt;=</span> <span class="m">0</span><span class="o">)</span> <span class="o">{</span>

			<span class="nx">nActiveDescendant</span> <span class="o">=</span> <span class="nx">nActiveDescendant</span> <span class="o">-</span> <span class="m">1</span><span class="o">;</span>

			<span class="k">if</span> <span class="o">(</span><span class="nx">nActiveDescendant</span> <span class="o">===</span> <span class="o">-</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">CIRCULAR</span><span class="o">))</span> <span class="o">{</span>
				<span class="nx">nActiveDescendant</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_lastNodeIndex</span><span class="o">;</span>
			<span class="o">}</span>

			<span class="nx">oNode</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_descendants</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="nx">nActiveDescendant</span><span class="o">);</span>

			<span class="k">if</span> <span class="o">(</span><span class="nx">oNode</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">DISABLED</span><span class="o">))</span> <span class="o">{</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">_focusPrevious</span><span class="o">(</span><span class="nx">event</span><span class="o">,</span> <span class="nx">nActiveDescendant</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">focus</span><span class="o">(</span><span class="nx">nActiveDescendant</span><span class="o">);</span>				
			<span class="o">}</span>

		<span class="o">}</span>
		
		<span class="k">this</span><span class="o">.</span><span class="nx">_preventScroll</span><span class="o">(</span><span class="nx">event</span><span class="o">);</span>			
	
	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method _afterActiveDescendantChange</span>
<span class="c">	* @description afterChange event handler for the </span>
<span class="c">	* &quot;activeDescendant&quot; attribute.</span>
<span class="c">	* @protected</span>
<span class="c">	* @param event {Object} Object representing the change event.</span>
<span class="c">	*/</span>	
	<span class="nx">_afterActiveDescendantChange</span><span class="o">:</span> <span class="k">function</span> <span class="o">(</span><span class="nx">event</span><span class="o">)</span> <span class="o">{</span>

		<span class="k">var</span> <span class="nx">oNode</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_descendants</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="nx">event</span><span class="o">.</span><span class="nx">prevVal</span><span class="o">);</span>
		
		<span class="k">if</span> <span class="o">(</span><span class="nx">oNode</span><span class="o">)</span> <span class="o">{</span>
			<span class="nx">oNode</span><span class="o">.</span><span class="nx">set</span><span class="o">(</span><span class="nx">TAB_INDEX</span><span class="o">,</span> <span class="o">-</span><span class="m">1</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="nx">oNode</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_descendants</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="nx">event</span><span class="o">.</span><span class="nx">newVal</span><span class="o">);</span>

		<span class="k">if</span> <span class="o">(</span><span class="nx">oNode</span><span class="o">)</span> <span class="o">{</span>
			<span class="nx">oNode</span><span class="o">.</span><span class="nx">set</span><span class="o">(</span><span class="nx">TAB_INDEX</span><span class="o">,</span> <span class="m">0</span><span class="o">);</span>
		<span class="o">}</span>
		
	<span class="o">},</span>



	<span class="c">//	Public methods</span>
<span class="c"></span>
    <span class="nx">initializer</span><span class="o">:</span> <span class="k">function</span> <span class="o">(</span><span class="nx">config</span><span class="o">)</span> <span class="o">{</span>

		<span class="k">this</span><span class="o">.</span><span class="nx">start</span><span class="o">();</span>

    <span class="o">},</span>

	<span class="nx">destructor</span><span class="o">:</span> <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>
		
		<span class="k">this</span><span class="o">.</span><span class="nx">stop</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">HOST</span><span class="o">).</span><span class="nx">focusManager</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		
    <span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method focus</span>
<span class="c">	* @description Focuses the active descendant and sets the  </span>
<span class="c">	* &lt;code&gt;focused&lt;/code&gt; attribute to true.</span>
<span class="c">	* @param index {Number} Optional. Number representing the index of the </span>
<span class="c">	* descendant to be set as the active descendant.</span>
<span class="c">	* @param index {Node} Optional. Node instance representing the </span>
<span class="c">	* descendant to be set as the active descendant.</span>
<span class="c">	*/</span>
	<span class="nx">focus</span><span class="o">:</span> <span class="k">function</span> <span class="o">(</span><span class="nx">index</span><span class="o">)</span> <span class="o">{</span>

		<span class="k">if</span> <span class="o">(</span><span class="nx">Lang</span><span class="o">.</span><span class="nx">isUndefined</span><span class="o">(</span><span class="nx">index</span><span class="o">))</span> <span class="o">{</span>
			<span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">ACTIVE_DESCENDANT</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="k">this</span><span class="o">.</span><span class="nx">set</span><span class="o">(</span><span class="nx">ACTIVE_DESCENDANT</span><span class="o">,</span> <span class="nx">index</span><span class="o">,</span> <span class="o">{</span> <span class="nx">src</span><span class="o">:</span> <span class="nx">UI</span> <span class="o">});</span>

		<span class="k">var</span> <span class="nx">oNode</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_descendants</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">ACTIVE_DESCENDANT</span><span class="o">));</span>

		<span class="k">if</span> <span class="o">(</span><span class="nx">oNode</span><span class="o">)</span> <span class="o">{</span>

			<span class="nx">oNode</span><span class="o">.</span><span class="nx">focus</span><span class="o">();</span>

			<span class="c">//	In Opera focusing a &lt;BUTTON&gt; element programmatically </span>
<span class="c"></span>			<span class="c">//	will result in the document-level focus event handler </span>
<span class="c"></span>			<span class="c">//	&quot;_onDocFocus&quot; being called, resulting in the handler </span>
<span class="c"></span>			<span class="c">//	incorrectly setting the &quot;focused&quot; Attribute to false.  To fix </span>
<span class="c"></span>			<span class="c">//	this, set a flag (&quot;_focusTarget&quot;) that the &quot;_onDocFocus&quot; method </span>
<span class="c"></span>			<span class="c">//	can look for to properly handle this edge case.</span>
<span class="c"></span>
			<span class="k">if</span> <span class="o">(</span><span class="nx">UA</span><span class="o">.</span><span class="nx">opera</span> <span class="o">&amp;&amp;</span> <span class="nx">oNode</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s2">&quot;nodeName&quot;</span><span class="o">).</span><span class="nx">toLowerCase</span><span class="o">()</span> <span class="o">===</span> <span class="s2">&quot;button&quot;</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">_focusTarget</span> <span class="o">=</span> <span class="nx">oNode</span><span class="o">;</span>
			<span class="o">}</span>

		<span class="o">}</span>

	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method blur</span>
<span class="c">	* @description Blurs the current active descendant and sets the </span>
<span class="c">	* &lt;code&gt;focused&lt;/code&gt; attribute to false.</span>
<span class="c">	*/</span>
	<span class="nx">blur</span><span class="o">:</span> <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>

		<span class="k">var</span> <span class="nx">oNode</span><span class="o">;</span>

		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">FOCUSED</span><span class="o">))</span> <span class="o">{</span>

			<span class="nx">oNode</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_descendants</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="nx">ACTIVE_DESCENDANT</span><span class="o">));</span>

			<span class="k">if</span> <span class="o">(</span><span class="nx">oNode</span><span class="o">)</span> <span class="o">{</span>

				<span class="nx">oNode</span><span class="o">.</span><span class="nx">blur</span><span class="o">();</span>

				<span class="c">//	For Opera and Webkit:  Blurring an element in either browser</span>
<span class="c"></span>				<span class="c">//	doesn&#39;t result in another element (such as the document)</span>
<span class="c"></span>				<span class="c">//	being focused.  Therefore, the &quot;_onDocFocus&quot; method </span>
<span class="c"></span>				<span class="c">//	responsible for managing the application and removal of the </span>
<span class="c"></span>				<span class="c">//	focus indicator class name is never called.</span>
<span class="c"></span>
				<span class="k">this</span><span class="o">.</span><span class="nx">_removeFocusClass</span><span class="o">();</span>
				
			<span class="o">}</span>

			<span class="k">this</span><span class="o">.</span><span class="nx">_set</span><span class="o">(</span><span class="nx">FOCUSED</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="o">{</span> <span class="nx">src</span><span class="o">:</span> <span class="nx">UI</span> <span class="o">});</span>
		<span class="o">}</span>
		
	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method start</span>
<span class="c">	* @description Enables the Focus Manager.</span>
<span class="c">	*/</span>
	<span class="nx">start</span><span class="o">:</span> <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>

		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_stopped</span><span class="o">)</span> <span class="o">{</span>

			<span class="k">this</span><span class="o">.</span><span class="nx">_initDescendants</span><span class="o">();</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">_attachEventHandlers</span><span class="o">();</span>

			<span class="k">this</span><span class="o">.</span><span class="nx">_stopped</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

		<span class="o">}</span>
		
	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method stop</span>
<span class="c">	* @description Disables the Focus Manager by detaching all event handlers.</span>
<span class="c">	*/</span>	
	<span class="nx">stop</span><span class="o">:</span> <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>

		<span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="nx">_stopped</span><span class="o">)</span> <span class="o">{</span>

			<span class="k">this</span><span class="o">.</span><span class="nx">_detachEventHandlers</span><span class="o">();</span>

			<span class="k">this</span><span class="o">.</span><span class="nx">_descendants</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">_focusedNode</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">_lastNodeIndex</span> <span class="o">=</span> <span class="m">0</span><span class="o">;</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">_stopped</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
			
		<span class="o">}</span>

	<span class="o">},</span>


	<span class="c">/**</span>
<span class="c">	* @method refresh</span>
<span class="c">	* @description Refreshes the Focus Manager&#39;s descendants by re-executing the </span>
<span class="c">	* CSS selector query specified by the &lt;code&gt;descendants&lt;/code&gt; attribute.</span>
<span class="c">	*/</span>
	<span class="nx">refresh</span><span class="o">:</span> <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>

		<span class="k">this</span><span class="o">.</span><span class="nx">_initDescendants</span><span class="o">();</span>
		
	<span class="o">}</span>
	
<span class="o">});</span>


<span class="nx">NodeFocusManager</span><span class="o">.</span><span class="nx">NAME</span> <span class="o">=</span> <span class="s2">&quot;nodeFocusManager&quot;</span><span class="o">;</span>
<span class="nx">NodeFocusManager</span><span class="o">.</span><span class="nx">NS</span> <span class="o">=</span> <span class="s2">&quot;focusManager&quot;</span><span class="o">;</span>

<span class="nx">Y</span><span class="o">.</span><span class="nx">namespace</span><span class="o">(</span><span class="s2">&quot;Plugin&quot;</span><span class="o">);</span>
<span class="nx">Y</span><span class="o">.</span><span class="nx">Plugin</span><span class="o">.</span><span class="nx">NodeFocusManager</span> <span class="o">=</span> <span class="nx">NodeFocusManager</span><span class="o">;</span>
</pre></div>

                    </div>
			</div>
		</div>
		<div class="yui-b">
            <div class="nav">

                    <div id="moduleList" class="module">
                        <h4>Modules</h4>
                        <ul class="content">
                                <li class=""><a href="module_anim.html" title="anim">anim</a></li>
                                <li class=""><a href="module_async-queue.html" title="async-queue">async-queue</a></li>
                                <li class=""><a href="module_attribute.html" title="attribute">attribute</a></li>
                                <li class=""><a href="module_base.html" title="base">base</a></li>
                                <li class=""><a href="module_cache.html" title="cache">cache</a></li>
                                <li class=""><a href="module_classnamemanager.html" title="classnamemanager">classnamemanager</a></li>
                                <li class=""><a href="module_collection.html" title="collection">collection</a></li>
                                <li class=""><a href="module_console.html" title="console">console</a></li>
                                <li class=""><a href="module_console-filters.html" title="console-filters">console-filters</a></li>
                                <li class=""><a href="module_cookie.html" title="cookie">cookie</a></li>
                                <li class=""><a href="module_dataschema.html" title="dataschema">dataschema</a></li>
                                <li class=""><a href="module_datasource.html" title="datasource">datasource</a></li>
                                <li class=""><a href="module_datatype.html" title="datatype">datatype</a></li>
                                <li class=""><a href="module_dd.html" title="dd">dd</a></li>
                                <li class=""><a href="module_dom.html" title="dom">dom</a></li>
                                <li class=""><a href="module_dump.html" title="dump">dump</a></li>
                                <li class=""><a href="module_event.html" title="event">event</a></li>
                                <li class=""><a href="module_event-custom.html" title="event-custom">event-custom</a></li>
                                <li class=""><a href="module_event-simulate.html" title="event-simulate">event-simulate</a></li>
                                <li class=""><a href="module_history.html" title="history">history</a></li>
                                <li class=""><a href="module_imageloader.html" title="imageloader">imageloader</a></li>
                                <li class=""><a href="module_io.html" title="io">io</a></li>
                                <li class=""><a href="module_json.html" title="json">json</a></li>
                                <li class=""><a href="module_loader.html" title="loader">loader</a></li>
                                <li class=""><a href="module_node.html" title="node">node</a></li>
                                <li class="selected"><a href="module_node-focusmanager.html" title="node-focusmanager">node-focusmanager</a></li>
                                <li class=""><a href="module_node-menunav.html" title="node-menunav">node-menunav</a></li>
                                <li class=""><a href="module_oop.html" title="oop">oop</a></li>
                                <li class=""><a href="module_overlay.html" title="overlay">overlay</a></li>
                                <li class=""><a href="module_plugin.html" title="plugin">plugin</a></li>
                                <li class=""><a href="module_profiler.html" title="profiler">profiler</a></li>
                                <li class=""><a href="module_queue-promote.html" title="queue-promote">queue-promote</a></li>
                                <li class=""><a href="module_shim-plugin.html" title="shim-plugin">shim-plugin</a></li>
                                <li class=""><a href="module_slider.html" title="slider">slider</a></li>
                                <li class=""><a href="module_stylesheet.html" title="stylesheet">stylesheet</a></li>
                                <li class=""><a href="module_substitute.html" title="substitute">substitute</a></li>
                                <li class=""><a href="module_test.html" title="test">test</a></li>
                                <li class=""><a href="module_widget.html" title="widget">widget</a></li>
                                <li class=""><a href="module_widget-position.html" title="widget-position">widget-position</a></li>
                                <li class=""><a href="module_widget-position-ext.html" title="widget-position-ext">widget-position-ext</a></li>
                                <li class=""><a href="module_widget-stack.html" title="widget-stack">widget-stack</a></li>
                                <li class=""><a href="module_widget-stdmod.html" title="widget-stdmod">widget-stdmod</a></li>
                                <li class=""><a href="module_yui.html" title="yui">yui</a></li>
                        </ul>
                    </div>

                    <div id="classList" class="module">
                        <h4>Classes</h4>
                        <ul class="content">
                                <li class=""><a href="plugin.NodeFocusManager.html" title="plugin.NodeFocusManager">plugin.NodeFocusManager</a></li>
                        </ul>
                    </div>

                    <div id="fileList" class="module">
                        <h4>Files</h4>
                        <ul class="content">        
                                <li class="selected"><a href="node-focusmanager.js.html" title="node-focusmanager.js">node-focusmanager.js</a></li>
                        </ul>
                    </div>





            </div>
		</div>
	</div>
	<div id="ft">
        <hr />
        Copyright &copy; 2009 Yahoo! Inc. All rights reserved.
	</div>
</div>
<script type="text/javascript">
    ALL_YUI_PROPS = [{"access": "", "host": "plugin.NodeFocusManager", "name": "activeDescendant", "url": "plugin.NodeFocusManager.html#config_activeDescendant", "type": "config"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "activeDescendantChange", "url": "plugin.NodeFocusManager.html#event_activeDescendantChange", "type": "event"}, {"access": "protected", "host": "plugin.NodeFocusManager", "name": "_afterActiveDescendantChange", "url": "plugin.NodeFocusManager.html#method__afterActiveDescendantChange", "type": "method"}, {"access": "protected", "host": "plugin.NodeFocusManager", "name": "_attachKeyHandler", "url": "plugin.NodeFocusManager.html#method__attachKeyHandler", "type": "method"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "blur", "url": "plugin.NodeFocusManager.html#method_blur", "type": "method"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "circular", "url": "plugin.NodeFocusManager.html#config_circular", "type": "config"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "circularChange", "url": "plugin.NodeFocusManager.html#event_circularChange", "type": "event"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "descendants", "url": "plugin.NodeFocusManager.html#config_descendants", "type": "config"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "descendantsChange", "url": "plugin.NodeFocusManager.html#event_descendantsChange", "type": "event"}, {"access": "protected", "host": "plugin.NodeFocusManager", "name": "_detachEventHandlers", "url": "plugin.NodeFocusManager.html#method__detachEventHandlers", "type": "method"}, {"access": "protected", "host": "plugin.NodeFocusManager", "name": "_detachKeyHandler", "url": "plugin.NodeFocusManager.html#method__detachKeyHandler", "type": "method"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "focus", "url": "plugin.NodeFocusManager.html#method_focus", "type": "method"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "focusClass", "url": "plugin.NodeFocusManager.html#config_focusClass", "type": "config"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "focusClassChange", "url": "plugin.NodeFocusManager.html#event_focusClassChange", "type": "event"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "focused", "url": "plugin.NodeFocusManager.html#config_focused", "type": "config"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "focusedChange", "url": "plugin.NodeFocusManager.html#event_focusedChange", "type": "event"}, {"access": "protected", "host": "plugin.NodeFocusManager", "name": "_focusNext", "url": "plugin.NodeFocusManager.html#method__focusNext", "type": "method"}, {"access": "protected", "host": "plugin.NodeFocusManager", "name": "_focusPrevious", "url": "plugin.NodeFocusManager.html#method__focusPrevious", "type": "method"}, {"access": "protected", "host": "plugin.NodeFocusManager", "name": "_initDescendants", "url": "plugin.NodeFocusManager.html#method__initDescendants", "type": "method"}, {"access": "protected", "host": "plugin.NodeFocusManager", "name": "_isDescendant", "url": "plugin.NodeFocusManager.html#method__isDescendant", "type": "method"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "keys", "url": "plugin.NodeFocusManager.html#config_keys", "type": "config"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "keysChange", "url": "plugin.NodeFocusManager.html#event_keysChange", "type": "event"}, {"access": "protected", "host": "plugin.NodeFocusManager", "name": "_onDocFocus", "url": "plugin.NodeFocusManager.html#method__onDocFocus", "type": "method"}, {"access": "protected", "host": "plugin.NodeFocusManager", "name": "_onDocMouseDown", "url": "plugin.NodeFocusManager.html#method__onDocMouseDown", "type": "method"}, {"access": "protected", "host": "plugin.NodeFocusManager", "name": "_preventScroll", "url": "plugin.NodeFocusManager.html#method__preventScroll", "type": "method"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "refresh", "url": "plugin.NodeFocusManager.html#method_refresh", "type": "method"}, {"access": "protected", "host": "plugin.NodeFocusManager", "name": "_removeFocusClass", "url": "plugin.NodeFocusManager.html#method__removeFocusClass", "type": "method"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "start", "url": "plugin.NodeFocusManager.html#method_start", "type": "method"}, {"access": "", "host": "plugin.NodeFocusManager", "name": "stop", "url": "plugin.NodeFocusManager.html#method_stop", "type": "method"}];
</script>
</body>
</html>
